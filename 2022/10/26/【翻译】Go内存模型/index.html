<!DOCTYPE html>
<html>

<head><meta name="generator" content="Hexo 3.9.0">
  <script type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script type="text/javascript" src="/js/jquery.goup.min.js" defer></script>
  
  <title>ã€ç¿»è¯‘ã€‘Goå†…å­˜æ¨¡å‹ - å¼ å°å‡¯çš„åšå®¢</title>
  <meta charset="UTF-8">
  <meta name="description" content="è¬™è™šã¯äººã‚’é€²æ­©ã•ã›ã€ã”ã†ã¾ã‚“ã¯äººã‚’è½å¾Œã•ã›ã‚‹ã€‚ç¤¾ä¼šã®åˆå¿ƒè€…ã‹ã‚‰ã€ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ï¼">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  

  <link rel="shortcut icon" href="/favicon.ico" type="image/png">
  <meta name="description" content="MITçš„Lecture5è¦æ±‚å…ˆé˜…è¯»Goå†…å­˜æ¨¡å‹ï¼Œè¿™ç¯‡æ–‡ç« å†™çš„æŒºå¥½çš„ï¼Œæ‰€ä»¥æ‰“ç®—ç¿»è¯‘ä¸€ä¸‹ï¼›">
<meta name="keywords" content="Golang">
<meta property="og:type" content="article">
<meta property="og:title" content="ã€ç¿»è¯‘ã€‘Goå†…å­˜æ¨¡å‹">
<meta property="og:url" content="https://jasonkayzk.github.io/2022/10/26/ã€ç¿»è¯‘ã€‘Goå†…å­˜æ¨¡å‹/index.html">
<meta property="og:site_name" content="å¼ å°å‡¯çš„åšå®¢">
<meta property="og:description" content="MITçš„Lecture5è¦æ±‚å…ˆé˜…è¯»Goå†…å­˜æ¨¡å‹ï¼Œè¿™ç¯‡æ–‡ç« å†™çš„æŒºå¥½çš„ï¼Œæ‰€ä»¥æ‰“ç®—ç¿»è¯‘ä¸€ä¸‹ï¼›">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2026-02-10T12:07:45.751Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ã€ç¿»è¯‘ã€‘Goå†…å­˜æ¨¡å‹">
<meta name="twitter:description" content="MITçš„Lecture5è¦æ±‚å…ˆé˜…è¯»Goå†…å­˜æ¨¡å‹ï¼Œè¿™ç¯‡æ–‡ç« å†™çš„æŒºå¥½çš„ï¼Œæ‰€ä»¥æ‰“ç®—ç¿»è¯‘ä¸€ä¸‹ï¼›">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdui@0.4.3/dist/css/mdui.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.16.2/styles/atom-one-dark.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1038733_0xvrvpg9c0r.css">
  <link rel="stylesheet" href="/css/style.css?v=1770725315912">

  <!-- è¿›åº¦æ¡åŠ è½½: nprogress -->
  <link href="https://cdn.bootcss.com/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <script src="https://cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>

  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6617852905105366" crossorigin="anonymous"></script>
  <!-- Cloudflare Web Analytics -->
   <script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{"token": "73d46a730654451bac205cdc12bea918"}"></script>
  <!-- umami Web Analytics -->
  <script defer src="https://cloud.umami.is/script.js" data-website-id="23fadd4b-d559-4ae0-a4f6-f90680c3d4c0"></script>

  <!-- æœ¬åœ°æœç´¢js -->
  <script type="text/javascript" src="/js/search.js"></script>

  <!-- ç™¾åº¦ç«™ç‚¹ç®¡ç† -->
  <meta name="baidu-site-verification" content="code-SKIvb4A1Qx">

  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-1NWK4EEKDF');
  </script>

  <!-- ç«™å†…é€šçŸ¥ -->
  <link href="https://apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" type="text/css" href="/css/default.css">
  <link rel="stylesheet" href="/css/animate.min.css">
  <link rel="stylesheet" href="/css/notification.css">
  <link rel="stylesheet" href="/css/index.css">
<link rel="alternate" href="/atom.xml" title="å¼ å°å‡¯çš„åšå®¢" type="application/atom+xml">
</head>

<!-- æ–‡ç« é˜…è¯»è¿›åº¦æ¡æ ·å¼ -->
<style>
  #content_progress {
      /* Positioning */
      position: fixed;
      left: 0;
      top: 0;
      z-index: 99999;
      width: 100%;
      height: 3px;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      border: none;
      background-color: transparent;
      color: #ffaa73;
}

#content_progress::-webkit-progress-bar {
      background-color: transparent;
}

#content_progress::-webkit-progress-value {
      background-color: #ffaa73;
}

#content_progress::-moz-progress-bar {
      background-color:#ffaa73;
}
</style>
<!-- æ–‡ç« é˜…è¯»è¿›åº¦æ¡JS -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
      var winHeight = window.innerHeight,
            docHeight = document.documentElement.scrollHeight,
            progressBar = document.querySelector('#content_progress');
      progressBar.max = docHeight - winHeight;
      progressBar.value = window.scrollY;

      document.addEventListener('scroll', function () {
            progressBar.max = document.documentElement.scrollHeight - window.innerHeight;
            progressBar.value = window.scrollY;
      });
});
</script>

<body class="mdui-drawer-body-left">
  <!-- æ–‡ç« é˜…è¯»è¿›åº¦æ¡ -->
  <progress id="content_progress" value="0"></progress>

  <!-- éŸ³é¢‘æ’­æ”¾ -->
  <!-- <link rel="stylesheet" href="/dist/APlayer.min.css">
  <div id="aplayer"></div>
  <script type="text/javascript" src="/dist/APlayer.min.js"></script>
  <script type="text/javascript" src="/dist/music.js"></script> -->

  
  <div id="nexmoe-background">
    <div class="nexmoe-bg" style="background-image: url(/images/bg.jpg)"></div>
    <div class="mdui-appbar mdui-shadow-0">
      <div class="mdui-toolbar">
        <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">menu</i></a>
        <div class="mdui-toolbar-spacer"></div>
        <a href="/" title="Jasonkay" class="mdui-btn mdui-btn-icon"><img src="/images/avatar4.jpg"></a>
      </div>
    </div>
  </div>
  <div id="nexmoe-header">
    <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="Jasonkay">
            <img src="/images/avatar4.jpg" alt="Jasonkay">
        </a>
    </div>

    <!-- é»‘ç™½åˆ‡æ¢css -->
    <!-- <style>
        .light-dark-checkbox {
            margin: 0 auto;
        }

        /* The switch - the box around the slider */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        /* Hide default HTML checkbox */
        .switch .theme-switcher {
            opacity: 0;
            width: 0;
            height: 0;
        }

        /* The slider */
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            transition: 0.4s;
        }

        .slider:before {
            position: absolute;
            content: "ğŸŒ";
            height: 0px;
            width: 0px;
            left: -10px;
            top: 16px;
            line-height: 0px;
            transition: 0.4s;
        }

        .theme-switcher:checked+.slider:before {
            left: 35px;
            content: "ğŸŒ‘";
        }

        .theme-switcher:checked+.slider:before {
            transform: translateX(45px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 40px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        /* æš—é»‘æ ·å¼ */
        body.night {
            background-color: #263238;
            color: #aaa;
        }
        body.night img {
            filter: brightness(30%);
        }
        article.night {
            background-color: black;
            color: white;
        }
    </style> -->

    <!-- é»‘ç™½å¼€å…³ -->
    <!-- <div class="nexmoe-list-item mdui-list-item">
        <div class="light-dark-checkbox">
            <div>
                é»‘ç™½æ¨¡å¼åˆ‡æ¢(Beta)
            </div>
            <label class="switch">
                <input id="light-dark-input" type="checkbox" onclick="switchTheme();" class="theme-switcher">
                <span class="slider round"></span>
            </label>
        </div>
    </div> -->

    <!-- é»‘ç™½åˆ‡æ¢js -->
    <!-- <script>
        // get hours of the day in 24Hr format (0-23)
        var hr = (new Date()).getHours();

        $(document).ready(function () {
            var theme = sessionStorage.getItem("theme");
            if (theme == "dark") {
                document.body.classList.add('night');
                console.log('å¤œé—´æ¨¡å¼å¼€å¯');
            } else if (theme == "light") {
                document.body.classList.remove('night');
                console.log('å¤œé—´æ¨¡å¼å…³é—­');
            } else {
                setDefaultTheme(hr);
            }
        });

        function switchTheme() {
            if (sessionStorage.getItem("theme") == "dark") {
                sessionStorage.setItem("theme", "light");
                document.body.classList.remove('night');
                console.log('å¤œé—´æ¨¡å¼å…³é—­');
            } else if (sessionStorage.getItem("theme") == "light") {
                sessionStorage.setItem("theme", "dark");
                document.body.classList.add('night');
                console.log('å¤œé—´æ¨¡å¼å¼€å¯');
            } else {
                setDefaultTheme(hr);
            }
        };

        function setDefaultTheme(curHr) {
            // 6:00-18:00 light
            if (curHr >= 6 && curHr <= 18) {
                document.body.classList.remove('night');
                console.log('å¤œé—´æ¨¡å¼å…³é—­');
                sessionStorage.setItem("theme", "light");
                $("#light-dark-input").attr("checked", false);
            } else {
                // 0:00-6:00 & 18:00-00:00 night
                sessionStorage.setItem("theme", "dark");
                document.body.classList.add('night');
                console.log('å¤œé—´æ¨¡å¼å¼€å¯');
                $("#light-dark-input").attr("checked", true);
            }
        }
    </script> -->

    <div class="nexmoe-count">
        <div><span>æ–‡ç« </span>522</div>
        <div><span>æ ‡ç­¾</span>277</div>
        <div><span>åˆ†ç±»</span>67</div>
    </div>
    <ul class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/" title="å›åˆ°é¦–é¡µ">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                å›åˆ°é¦–é¡µ
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/jp/" title="æ—¥è¯­åˆ†ç«™">
            <i class="mdui-list-item-icon nexmoefont icon-calendar-fill"></i>
            <div class="mdui-list-item-content">
                æ—¥è¯­åˆ†ç«™
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/about/" title="å…³äºåšå®¢">
            <i class="mdui-list-item-icon nexmoefont icon-eye-fill"></i>
            <div class="mdui-list-item-content">
                å…³äºåšå®¢
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/archive" title="æ–‡ç« å½’æ¡£">
            <i class="mdui-list-item-icon nexmoefont icon-container"></i>
            <div class="mdui-list-item-content">
                æ–‡ç« å½’æ¡£
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/anki/" title="Ankiç¬”è®°">
            <i class="mdui-list-item-icon nexmoefont icon-tag-fill"></i>
            <div class="mdui-list-item-content">
                Ankiç¬”è®°
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/study/" title="å­¦ä¹ è¿›åº¦">
            <i class="mdui-list-item-icon nexmoefont icon-telegram"></i>
            <div class="mdui-list-item-content">
                å­¦ä¹ è¿›åº¦
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/running/" title="è·‘æ­¥å¥èº«">
            <i class="mdui-list-item-icon nexmoefont icon-dribbble"></i>
            <div class="mdui-list-item-content">
                è·‘æ­¥å¥èº«
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/interview/" title="é¢è¯•ç›¸å…³">
            <i class="mdui-list-item-icon nexmoefont icon-container"></i>
            <div class="mdui-list-item-content">
                é¢è¯•ç›¸å…³
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/algorithm/" title="ç®—æ³•æ€»ç»“">
            <i class="mdui-list-item-icon nexmoefont icon-areachart"></i>
            <div class="mdui-list-item-content">
                ç®—æ³•æ€»ç»“
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/installing/" title="è½¯ä»¶å®‰è£…">
            <i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i>
            <div class="mdui-list-item-content">
                è½¯ä»¶å®‰è£…
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/board/" title="åˆ›æ„ç™½æ¿">
            <i class="mdui-list-item-icon nexmoefont icon-tag-fill"></i>
            <div class="mdui-list-item-content">
                åˆ›æ„ç™½æ¿
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="http://159.75.131.252:32352/" title="æ‘„å½±åˆ†äº«">
            <i class="mdui-list-item-icon nexmoefont icon-telegram"></i>
            <div class="mdui-list-item-content">
                æ‘„å½±åˆ†äº«
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/chat/" title="ç•…æ‰€æ¬²è¨€">
            <i class="mdui-list-item-icon nexmoefont icon-ellipsis"></i>
            <div class="mdui-list-item-content">
                ç•…æ‰€æ¬²è¨€
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/realtime/" title="å®æ—¶æ•°æ®ç»Ÿè®¡">
            <i class="mdui-list-item-icon nexmoefont icon-time-circle-fill"></i>
            <div class="mdui-list-item-content">
                å®æ—¶æ•°æ®ç»Ÿè®¡
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/py/" title="å‹æƒ…é“¾æ¥">
            <i class="mdui-list-item-icon nexmoefont icon-container"></i>
            <div class="mdui-list-item-content">
                å‹æƒ…é“¾æ¥
            </div>
        </a>
        
    </ul>
    <aside id="nexmoe-sidebar">
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">ç¤¾äº¤æŒ‰é’®</h3>
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://space.bilibili.com/23364338" target="_blank" mdui-tooltip="{content: 'å“”å“©å“”å“©'}" style="color: rgb(231, 106, 141);background-color: rgba(231, 106, 141, .15);">
            <i class="nexmoefont icon-bilibili"></i>
        </a><a class="mdui-ripple" href="https://github.com/jasonkayzk/" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a><a class="mdui-ripple" href="https://steamcommunity.com/id/jasonkayzk/" target="_blank" mdui-tooltip="{content: 'Steam'}" style="color: rgb(29, 161, 242);background-color: rgba(29, 161, 242, .1);">
            <i class="nexmoefont icon-steam"></i>
        </a><a class="mdui-ripple" href="https://twitter.com/Jasonkay_ZK/" target="_blank" mdui-tooltip="{content: 'Twitter'}" style="color: rgb(29, 161, 242);background-color: rgba(29, 161, 242, .1);">
            <i class="nexmoefont icon-twitter"></i>
        </a><a class="mdui-ripple" href="mailto:jasonkayzk@gmail.com" target="_blank" mdui-tooltip="{content: 'Mail'}" style="color: rgb(29, 161, 242);background-color: rgba(29, 161, 242, .1);">
            <i class="nexmoefont icon-mail-fill"></i>
        </a>
    </div>
</div>
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">ç«™å†…æœç´¢</h3>
    <div class="nexmoe-widget nexmoe-search">
        <form class="site-search-form">
            <input type="text" id="local-search-input" class="st-search-input">
        </form>
        <div id="local-search-result" class="local-search-result-cls">
        </div>
    </div>
</div>

<!-- æ‰§è¡Œæœ¬åœ°æœç´¢è„šæœ¬ -->
<script type="text/javascript">
    var path = "https://cdn.jsdelivr.net/gh/jasonkayzk/JasonkayZK.github.io@master/search.xml";
    searchFunc(path, 'local-search-input', 'local-search-result');
</script>

<style type="text/css">
/* æœç´¢æ¡ */
.site-search-form {
    text-align: center;
}
#local-search-input {
    width: 100%;
}

/* æœç´¢ç»“æœå…³é—­ */
#local-search-close {
    font-size: 22.5px;
    cursor: pointer;
    color: #ff4e6a;
}

.search-result-list > li {
    line-height: 0.75;
    margin-top: -5px;
}

</style>
  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">æ ‡ç­¾äº‘</h3>
    <div id="randomtagcloud" class="nexmoe-widget tagcloud">
      <a href="/tags/2048/" style="font-size: 10px;">2048</a> <a href="/tags/ACM/" style="font-size: 10px;">ACM</a> <a href="/tags/AI/" style="font-size: 10px;">AI</a> <a href="/tags/AUFS/" style="font-size: 10px;">AUFS</a> <a href="/tags/Android/" style="font-size: 10.91px;">Android</a> <a href="/tags/AppStore/" style="font-size: 10px;">AppStore</a> <a href="/tags/AppleScript/" style="font-size: 10px;">AppleScript</a> <a href="/tags/Aria2/" style="font-size: 10.91px;">Aria2</a> <a href="/tags/Async/" style="font-size: 10px;">Async</a> <a href="/tags/BFS/" style="font-size: 10.45px;">BFS</a> <a href="/tags/Bash/" style="font-size: 10.45px;">Bash</a> <a href="/tags/BitTorrent/" style="font-size: 10px;">BitTorrent</a> <a href="/tags/BloomFilter/" style="font-size: 10px;">BloomFilter</a> <a href="/tags/Bytebase/" style="font-size: 10px;">Bytebase</a> <a href="/tags/C/" style="font-size: 15.91px;">C++</a> <a href="/tags/CAP/" style="font-size: 10px;">CAP</a> <a href="/tags/CDN/" style="font-size: 10.45px;">CDN</a> <a href="/tags/CGLibåŠ¨æ€ä»£ç†/" style="font-size: 10px;">CGLibåŠ¨æ€ä»£ç†</a> <a href="/tags/CUDA/" style="font-size: 10px;">CUDA</a> <a href="/tags/Cache/" style="font-size: 10px;">Cache</a> <a href="/tags/Caffeine/" style="font-size: 10px;">Caffeine</a> <a href="/tags/Cargo/" style="font-size: 11.82px;">Cargo</a> <a href="/tags/CentOS/" style="font-size: 12.27px;">CentOS</a> <a href="/tags/Cgroups/" style="font-size: 10px;">Cgroups</a> <a href="/tags/Chromeæ‰©å±•/" style="font-size: 10px;">Chromeæ‰©å±•</a> <a href="/tags/Cli/" style="font-size: 10.45px;">Cli</a> <a href="/tags/ClickHouse/" style="font-size: 10px;">ClickHouse</a> <a href="/tags/Cling/" style="font-size: 10px;">Cling</a> <a href="/tags/Clion/" style="font-size: 10px;">Clion</a> <a href="/tags/Colima/" style="font-size: 10px;">Colima</a> <a href="/tags/Container/" style="font-size: 10px;">Container</a> <a href="/tags/DFS/" style="font-size: 10.45px;">DFS</a> <a href="/tags/DLL/" style="font-size: 10.45px;">DLL</a> <a href="/tags/Debian/" style="font-size: 10px;">Debian</a> <a href="/tags/Docker/" style="font-size: 18.64px;">Docker</a> <a href="/tags/Docker-Compose/" style="font-size: 10.45px;">Docker-Compose</a> <a href="/tags/DockerHub/" style="font-size: 10px;">DockerHub</a> <a href="/tags/Dolt/" style="font-size: 10px;">Dolt</a> <a href="/tags/Dubbo/" style="font-size: 10.91px;">Dubbo</a> <a href="/tags/Easegress/" style="font-size: 10px;">Easegress</a> <a href="/tags/ElasticSearch/" style="font-size: 14.09px;">ElasticSearch</a> <a href="/tags/Electron/" style="font-size: 10.45px;">Electron</a> <a href="/tags/English/" style="font-size: 10px;">English</a> <a href="/tags/Excel/" style="font-size: 10px;">Excel</a> <a href="/tags/Express/" style="font-size: 10px;">Express</a> <a href="/tags/FFmpeg/" style="font-size: 10px;">FFmpeg</a> <a href="/tags/FTP/" style="font-size: 10.45px;">FTP</a> <a href="/tags/FaaS/" style="font-size: 10px;">FaaS</a> <a href="/tags/Future/" style="font-size: 10px;">Future</a> <a href="/tags/GC/" style="font-size: 10px;">GC</a> <a href="/tags/GPU/" style="font-size: 10px;">GPU</a> <a href="/tags/GRPC/" style="font-size: 10px;">GRPC</a> <a href="/tags/Gin/" style="font-size: 10px;">Gin</a> <a href="/tags/Git/" style="font-size: 13.64px;">Git</a> <a href="/tags/Gitee/" style="font-size: 10px;">Gitee</a> <a href="/tags/Github/" style="font-size: 14.55px;">Github</a> <a href="/tags/Github-Actions/" style="font-size: 10px;">Github-Actions</a> <a href="/tags/Golang/" style="font-size: 18.18px;">Golang</a> <a href="/tags/Gomod/" style="font-size: 10px;">Gomod</a> <a href="/tags/Goroutine/" style="font-size: 10.91px;">Goroutine</a> <a href="/tags/GraalVM/" style="font-size: 10px;">GraalVM</a> <a href="/tags/Gradle/" style="font-size: 10px;">Gradle</a> <a href="/tags/GraphQL/" style="font-size: 10px;">GraphQL</a> <a href="/tags/HAProxy/" style="font-size: 10px;">HAProxy</a> <a href="/tags/Hadoop/" style="font-size: 10px;">Hadoop</a> <a href="/tags/IDEAé…ç½®/" style="font-size: 10px;">IDEAé…ç½®</a> <a href="/tags/IDç”Ÿæˆå™¨/" style="font-size: 10.45px;">IDç”Ÿæˆå™¨</a> <a href="/tags/IOæ¨¡å‹/" style="font-size: 10px;">IOæ¨¡å‹</a> <a href="/tags/Ingress/" style="font-size: 10.45px;">Ingress</a> <a href="/tags/JDKåŠ¨æ€ä»£ç†/" style="font-size: 10.45px;">JDKåŠ¨æ€ä»£ç†</a> <a href="/tags/JVM/" style="font-size: 10px;">JVM</a> <a href="/tags/Java/" style="font-size: 12.27px;">Java</a> <a href="/tags/JavaWeb/" style="font-size: 10px;">JavaWeb</a> <a href="/tags/JavaåŸºç¡€/" style="font-size: 16.82px;">JavaåŸºç¡€</a> <a href="/tags/Javaæ³¨è§£/" style="font-size: 10px;">Javaæ³¨è§£</a> <a href="/tags/Javaæºç /" style="font-size: 12.27px;">Javaæºç </a> <a href="/tags/Javaé¢è¯•/" style="font-size: 11.36px;">Javaé¢è¯•</a> <a href="/tags/JuiceFS/" style="font-size: 10px;">JuiceFS</a> <a href="/tags/JupyterLab/" style="font-size: 10px;">JupyterLab</a> <a href="/tags/Kafka/" style="font-size: 10.45px;">Kafka</a> <a href="/tags/Kubernetes/" style="font-size: 15.45px;">Kubernetes</a> <a href="/tags/LVS/" style="font-size: 10.91px;">LVS</a> <a href="/tags/Lambdaè¡¨è¾¾å¼/" style="font-size: 10.91px;">Lambdaè¡¨è¾¾å¼</a> <a href="/tags/LevelDB/" style="font-size: 10px;">LevelDB</a> <a href="/tags/Library/" style="font-size: 10.45px;">Library</a> <a href="/tags/Life/" style="font-size: 10px;">Life</a> <a href="/tags/Linux/" style="font-size: 16.36px;">Linux</a> <a href="/tags/LruCache/" style="font-size: 10px;">LruCache</a> <a href="/tags/MacOS/" style="font-size: 10.45px;">MacOS</a> <a href="/tags/Maven/" style="font-size: 12.27px;">Maven</a> <a href="/tags/MongoDB/" style="font-size: 11.82px;">MongoDB</a> <a href="/tags/MySQL/" style="font-size: 13.64px;">MySQL</a> <a href="/tags/Mybatis/" style="font-size: 10.91px;">Mybatis</a> <a href="/tags/NFS/" style="font-size: 10px;">NFS</a> <a href="/tags/NIO/" style="font-size: 10.91px;">NIO</a> <a href="/tags/NPM/" style="font-size: 10px;">NPM</a> <a href="/tags/Namespace/" style="font-size: 10px;">Namespace</a> <a href="/tags/Netty/" style="font-size: 10px;">Netty</a> <a href="/tags/Newman/" style="font-size: 10px;">Newman</a> <a href="/tags/Nginx/" style="font-size: 12.27px;">Nginx</a> <a href="/tags/Node-js/" style="font-size: 11.36px;">Node.js</a> <a href="/tags/Okular/" style="font-size: 10px;">Okular</a> <a href="/tags/P2P/" style="font-size: 10px;">P2P</a> <a href="/tags/POML/" style="font-size: 10px;">POML</a> <a href="/tags/Panic/" style="font-size: 10px;">Panic</a> <a href="/tags/PipelineDB/" style="font-size: 10px;">PipelineDB</a> <a href="/tags/PostgreSQL/" style="font-size: 10.45px;">PostgreSQL</a> <a href="/tags/Postman/" style="font-size: 10.45px;">Postman</a> <a href="/tags/Promise/" style="font-size: 10px;">Promise</a> <a href="/tags/Protobuf/" style="font-size: 10.91px;">Protobuf</a> <a href="/tags/Python/" style="font-size: 11.36px;">Python</a> <a href="/tags/RAII/" style="font-size: 10px;">RAII</a> <a href="/tags/RPC/" style="font-size: 10px;">RPC</a> <a href="/tags/RSS/" style="font-size: 10.91px;">RSS</a> <a href="/tags/React/" style="font-size: 10px;">React</a> <a href="/tags/Redash/" style="font-size: 10px;">Redash</a> <a href="/tags/Redis/" style="font-size: 14.55px;">Redis</a> <a href="/tags/Ruby/" style="font-size: 10px;">Ruby</a> <a href="/tags/Rust/" style="font-size: 18.64px;">Rust</a> <a href="/tags/SPA/" style="font-size: 10px;">SPA</a> <a href="/tags/SQLite/" style="font-size: 10px;">SQLite</a> <a href="/tags/SSE/" style="font-size: 10px;">SSE</a> <a href="/tags/SSH/" style="font-size: 10.45px;">SSH</a> <a href="/tags/Serverless/" style="font-size: 10px;">Serverless</a> <a href="/tags/Shadowsocks/" style="font-size: 10.91px;">Shadowsocks</a> <a href="/tags/Skiplist/" style="font-size: 10px;">Skiplist</a> <a href="/tags/Slice/" style="font-size: 10px;">Slice</a> <a href="/tags/Socket/" style="font-size: 10px;">Socket</a> <a href="/tags/Spring/" style="font-size: 11.82px;">Spring</a> <a href="/tags/Spring-Boot/" style="font-size: 10px;">Spring Boot</a> <a href="/tags/Springæºç /" style="font-size: 10px;">Springæºç </a> <a href="/tags/String/" style="font-size: 10px;">String</a> <a href="/tags/Swagger/" style="font-size: 10px;">Swagger</a> <a href="/tags/TOML/" style="font-size: 10px;">TOML</a> <a href="/tags/Telegraf/" style="font-size: 10px;">Telegraf</a> <a href="/tags/Telegram/" style="font-size: 10px;">Telegram</a> <a href="/tags/Tomcat/" style="font-size: 10.45px;">Tomcat</a> <a href="/tags/TypeScript/" style="font-size: 10px;">TypeScript</a> <a href="/tags/Typora/" style="font-size: 10px;">Typora</a> <a href="/tags/UUID/" style="font-size: 10px;">UUID</a> <a href="/tags/UnionFS/" style="font-size: 10px;">UnionFS</a> <a href="/tags/VMWare/" style="font-size: 13.18px;">VMWare</a> <a href="/tags/VPN/" style="font-size: 10px;">VPN</a> <a href="/tags/WebAssembly/" style="font-size: 10.45px;">WebAssembly</a> <a href="/tags/Websocket/" style="font-size: 10px;">Websocket</a> <a href="/tags/XML/" style="font-size: 10.91px;">XML</a> <a href="/tags/YAML/" style="font-size: 10px;">YAML</a> <a href="/tags/Zookeeper/" style="font-size: 10.91px;">Zookeeper</a> <a href="/tags/apt/" style="font-size: 10px;">apt</a> <a href="/tags/autok3s/" style="font-size: 10px;">autok3s</a> <a href="/tags/cURL/" style="font-size: 10px;">cURL</a> <a href="/tags/chroot/" style="font-size: 10px;">chroot</a> <a href="/tags/cmder/" style="font-size: 10px;">cmder</a> <a href="/tags/grpc/" style="font-size: 10px;">grpc</a> <a href="/tags/hashå†²çª/" style="font-size: 10px;">hashå†²çª</a> <a href="/tags/inoreader/" style="font-size: 10px;">inoreader</a> <a href="/tags/k3s/" style="font-size: 10.45px;">k3s</a> <a href="/tags/kafka/" style="font-size: 10px;">kafka</a> <a href="/tags/keepalived/" style="font-size: 10px;">keepalived</a> <a href="/tags/libp2p/" style="font-size: 10px;">libp2p</a> <a href="/tags/minikube/" style="font-size: 10.45px;">minikube</a> <a href="/tags/ntfy/" style="font-size: 10px;">ntfy</a> <a href="/tags/picocli/" style="font-size: 10px;">picocli</a> <a href="/tags/telnet/" style="font-size: 10px;">telnet</a> <a href="/tags/uv/" style="font-size: 10px;">uv</a> <a href="/tags/vcpkg/" style="font-size: 10px;">vcpkg</a> <a href="/tags/xorm/" style="font-size: 10px;">xorm</a> <a href="/tags/äºŒåˆ†æ³•/" style="font-size: 10px;">äºŒåˆ†æ³•</a> <a href="/tags/äºŒå‰æ ‘/" style="font-size: 15.45px;">äºŒå‰æ ‘</a> <a href="/tags/äºŒç»´ç /" style="font-size: 10px;">äºŒç»´ç </a> <a href="/tags/äº¤å‰ç¼–è¯‘/" style="font-size: 10px;">äº¤å‰ç¼–è¯‘</a> <a href="/tags/äººå·¥æ™ºèƒ½/" style="font-size: 10.91px;">äººå·¥æ™ºèƒ½</a> <a href="/tags/äººç”Ÿæ—¥è®°/" style="font-size: 17.73px;">äººç”Ÿæ—¥è®°</a> <a href="/tags/ä»£ç†æ¨¡å¼/" style="font-size: 10px;">ä»£ç†æ¨¡å¼</a> <a href="/tags/ä½è¿ç®—/" style="font-size: 10.45px;">ä½è¿ç®—</a> <a href="/tags/ä¿¡å·/" style="font-size: 10px;">ä¿¡å·</a> <a href="/tags/ä¿¡æ¯èšåˆ/" style="font-size: 10px;">ä¿¡æ¯èšåˆ</a> <a href="/tags/å†…å­˜ç®¡ç†/" style="font-size: 10.45px;">å†…å­˜ç®¡ç†</a> <a href="/tags/å†…ç½‘ç©¿é€/" style="font-size: 10px;">å†…ç½‘ç©¿é€</a> <a href="/tags/å‡½æ•°å¼æ¥å£/" style="font-size: 10px;">å‡½æ•°å¼æ¥å£</a> <a href="/tags/åˆ†å¸ƒå¼/" style="font-size: 15.91px;">åˆ†å¸ƒå¼</a> <a href="/tags/åŠå…¬/" style="font-size: 10px;">åŠå…¬</a> <a href="/tags/åŠ¨æ€è§„åˆ’/" style="font-size: 11.36px;">åŠ¨æ€è§„åˆ’</a> <a href="/tags/åç¨‹æ± /" style="font-size: 10px;">åç¨‹æ± </a> <a href="/tags/åšå®¢ç®¡ç†/" style="font-size: 13.18px;">åšå®¢ç®¡ç†</a> <a href="/tags/åšå®¢ç¾åŒ–/" style="font-size: 11.82px;">åšå®¢ç¾åŒ–</a> <a href="/tags/åŒæŒ‡é’ˆ/" style="font-size: 10.45px;">åŒæŒ‡é’ˆ</a> <a href="/tags/åå°„/" style="font-size: 12.27px;">åå°„</a> <a href="/tags/å£æ‰/" style="font-size: 10px;">å£æ‰</a> <a href="/tags/å“ˆå¸Œè¡¨/" style="font-size: 10.45px;">å“ˆå¸Œè¡¨</a> <a href="/tags/å›æº¯/" style="font-size: 10.45px;">å›æº¯</a> <a href="/tags/å›æº¯æ³•/" style="font-size: 10px;">å›æº¯æ³•</a> <a href="/tags/å †/" style="font-size: 10.45px;">å †</a> <a href="/tags/å¤šçº¿ç¨‹ä¸‹è½½/" style="font-size: 10.45px;">å¤šçº¿ç¨‹ä¸‹è½½</a> <a href="/tags/å¤§æ•°æ®/" style="font-size: 10px;">å¤§æ•°æ®</a> <a href="/tags/å­—ç¬¦ä¸²/" style="font-size: 13.18px;">å­—ç¬¦ä¸²</a> <a href="/tags/å­—ç¬¦ä¸²å¤„ç†/" style="font-size: 10px;">å­—ç¬¦ä¸²å¤„ç†</a> <a href="/tags/å­¦ä¹ æ¡ˆä¾‹/" style="font-size: 10.45px;">å­¦ä¹ æ¡ˆä¾‹</a> <a href="/tags/å®¹å™¨/" style="font-size: 10px;">å®¹å™¨</a> <a href="/tags/å·¥å…·åˆ†äº«/" style="font-size: 19.09px;">å·¥å…·åˆ†äº«</a> <a href="/tags/å¹¶å‘ç¼–ç¨‹/" style="font-size: 15.45px;">å¹¶å‘ç¼–ç¨‹</a> <a href="/tags/å¹¶è¡Œè®¡ç®—/" style="font-size: 10px;">å¹¶è¡Œè®¡ç®—</a> <a href="/tags/åºåˆ—åŒ–/" style="font-size: 10px;">åºåˆ—åŒ–</a> <a href="/tags/å»ºç­‘/" style="font-size: 10px;">å»ºç­‘</a> <a href="/tags/å¼€å‘è§„èŒƒ/" style="font-size: 10.45px;">å¼€å‘è§„èŒƒ</a> <a href="/tags/å¼€æºåè®®/" style="font-size: 10px;">å¼€æºåè®®</a> <a href="/tags/æ€§èƒ½æŒ‡æ ‡/" style="font-size: 10px;">æ€§èƒ½æŒ‡æ ‡</a> <a href="/tags/æŠ€æœ¯æ‚è°ˆ/" style="font-size: 20px;">æŠ€æœ¯æ‚è°ˆ</a> <a href="/tags/æ’åº/" style="font-size: 11.82px;">æ’åº</a> <a href="/tags/æ¨é€/" style="font-size: 10px;">æ¨é€</a> <a href="/tags/æœç´¢/" style="font-size: 10px;">æœç´¢</a> <a href="/tags/æ“ä½œç³»ç»Ÿ/" style="font-size: 10.91px;">æ“ä½œç³»ç»Ÿ</a> <a href="/tags/æ•™å¸ˆ/" style="font-size: 10.45px;">æ•™å¸ˆ</a> <a href="/tags/æ•™æ¡ˆ/" style="font-size: 10.45px;">æ•™æ¡ˆ</a> <a href="/tags/æ•°å­¦/" style="font-size: 12.73px;">æ•°å­¦</a> <a href="/tags/æ•°æ®åº“/" style="font-size: 15px;">æ•°æ®åº“</a> <a href="/tags/æ•°ç»„/" style="font-size: 13.64px;">æ•°ç»„</a> <a href="/tags/æ–‡å­—éšè—/" style="font-size: 10px;">æ–‡å­—éšè—</a> <a href="/tags/æ–­ç‚¹ç»­ä¼ /" style="font-size: 10px;">æ–­ç‚¹ç»­ä¼ </a> <a href="/tags/æ–°æµªå¾®åš/" style="font-size: 10px;">æ–°æµªå¾®åš</a> <a href="/tags/æ—¥å¿—/" style="font-size: 10px;">æ—¥å¿—</a> <a href="/tags/æ—¥æœ¬èª/" style="font-size: 14.55px;">æ—¥æœ¬èª</a> <a href="/tags/æ—¥è¨˜/" style="font-size: 10.45px;">æ—¥è¨˜</a> <a href="/tags/æœåŠ¡è‡ªå»º/" style="font-size: 10.91px;">æœåŠ¡è‡ªå»º</a> <a href="/tags/æŸ¥æ‰¾/" style="font-size: 10.91px;">æŸ¥æ‰¾</a> <a href="/tags/æ ˆ/" style="font-size: 10.91px;">æ ˆ</a> <a href="/tags/æ­Œè©/" style="font-size: 10px;">æ­Œè©</a> <a href="/tags/æ­£åˆ™è¡¨è¾¾å¼/" style="font-size: 10.91px;">æ­£åˆ™è¡¨è¾¾å¼</a> <a href="/tags/æ±‡ç¼–è¯­è¨€/" style="font-size: 10px;">æ±‡ç¼–è¯­è¨€</a> <a href="/tags/æµ‹è¯•/" style="font-size: 10px;">æµ‹è¯•</a> <a href="/tags/æ»‘çª—/" style="font-size: 10px;">æ»‘çª—</a> <a href="/tags/ç‰ˆæœ¬æ§åˆ¶/" style="font-size: 10px;">ç‰ˆæœ¬æ§åˆ¶</a> <a href="/tags/ç”Ÿæ´»æ€»ç»“/" style="font-size: 10px;">ç”Ÿæ´»æ€»ç»“</a> <a href="/tags/ç¦åˆ©åˆ†äº«/" style="font-size: 10px;">ç¦åˆ©åˆ†äº«</a> <a href="/tags/ç®—æ³•/" style="font-size: 12.73px;">ç®—æ³•</a> <a href="/tags/ç®—æ³•é¢˜ç›®/" style="font-size: 19.55px;">ç®—æ³•é¢˜ç›®</a> <a href="/tags/ç±»åŠ è½½å™¨/" style="font-size: 10.45px;">ç±»åŠ è½½å™¨</a> <a href="/tags/ç´ æ•°/" style="font-size: 10px;">ç´ æ•°</a> <a href="/tags/çº¿æ€§æ¢æµ‹æ³•/" style="font-size: 10px;">çº¿æ€§æ¢æµ‹æ³•</a> <a href="/tags/çº¿ç¨‹æ± /" style="font-size: 10.91px;">çº¿ç¨‹æ± </a> <a href="/tags/ç¼–è¯‘ä¼˜åŒ–/" style="font-size: 10px;">ç¼–è¯‘ä¼˜åŒ–</a> <a href="/tags/ç¼–è¯‘å™¨/" style="font-size: 10px;">ç¼–è¯‘å™¨</a> <a href="/tags/ç½‘ç›˜/" style="font-size: 10px;">ç½‘ç›˜</a> <a href="/tags/ç½‘ç»œçº¿è·¯/" style="font-size: 10px;">ç½‘ç»œçº¿è·¯</a> <a href="/tags/ç¿»è¨³/" style="font-size: 10.45px;">ç¿»è¨³</a> <a href="/tags/è‡ªå¯åŠ¨/" style="font-size: 10px;">è‡ªå¯åŠ¨</a> <a href="/tags/è’™ç‰¹å¡ç½—æ–¹æ³•/" style="font-size: 10px;">è’™ç‰¹å¡ç½—æ–¹æ³•</a> <a href="/tags/è™šæ‹Ÿæœº/" style="font-size: 10.45px;">è™šæ‹Ÿæœº</a> <a href="/tags/è¡—æ™¯/" style="font-size: 10px;">è¡—æ™¯</a> <a href="/tags/è£…é¥°å™¨æ¨¡å¼/" style="font-size: 10px;">è£…é¥°å™¨æ¨¡å¼</a> <a href="/tags/è®¡ç®—æœºç½‘ç»œ/" style="font-size: 10px;">è®¡ç®—æœºç½‘ç»œ</a> <a href="/tags/è®¾è®¡æ¨¡å¼/" style="font-size: 10px;">è®¾è®¡æ¨¡å¼</a> <a href="/tags/è¯¾ç¨‹/" style="font-size: 10px;">è¯¾ç¨‹</a> <a href="/tags/è´Ÿè½½å‡è¡¡/" style="font-size: 12.27px;">è´Ÿè½½å‡è¡¡</a> <a href="/tags/è´ªå¿ƒ/" style="font-size: 10px;">è´ªå¿ƒ</a> <a href="/tags/è·³è·³è›™æ—¥è¯­è¯»åº“/" style="font-size: 10.45px;">è·³è·³è›™æ—¥è¯­è¯»åº“</a> <a href="/tags/è½¯ä»¶å®‰è£…ä¸é…ç½®/" style="font-size: 17.27px;">è½¯ä»¶å®‰è£…ä¸é…ç½®</a> <a href="/tags/è½¯ä»¶æ¨è/" style="font-size: 15px;">è½¯ä»¶æ¨è</a> <a href="/tags/è½¯ä»¶æµ‹è¯•/" style="font-size: 10.45px;">è½¯ä»¶æµ‹è¯•</a> <a href="/tags/è½¯è€ƒ/" style="font-size: 10px;">è½¯è€ƒ</a> <a href="/tags/è¿›åº¦æ¡/" style="font-size: 10.45px;">è¿›åº¦æ¡</a> <a href="/tags/è¿›ç¨‹é€šä¿¡/" style="font-size: 10px;">è¿›ç¨‹é€šä¿¡</a> <a href="/tags/é€†å‘å·¥ç¨‹/" style="font-size: 10px;">é€†å‘å·¥ç¨‹</a> <a href="/tags/é€’å½’/" style="font-size: 10.45px;">é€’å½’</a> <a href="/tags/é‡å®šå‘/" style="font-size: 10px;">é‡å®šå‘</a> <a href="/tags/é‡è£…ç³»ç»Ÿ/" style="font-size: 10px;">é‡è£…ç³»ç»Ÿ</a> <a href="/tags/é“¾è¡¨/" style="font-size: 13.64px;">é“¾è¡¨</a> <a href="/tags/é˜Ÿåˆ—/" style="font-size: 10px;">é˜Ÿåˆ—</a> <a href="/tags/éšæœºå›¾ç‰‡/" style="font-size: 10px;">éšæœºå›¾ç‰‡</a> <a href="/tags/é›†åˆ/" style="font-size: 14.09px;">é›†åˆ</a> <a href="/tags/é›¶å®½å­—ç¬¦/" style="font-size: 10px;">é›¶å®½å­—ç¬¦</a> <a href="/tags/é™æ€ä»£ç†/" style="font-size: 10px;">é™æ€ä»£ç†</a> <a href="/tags/é¢è¯•æ€»ç»“/" style="font-size: 15px;">é¢è¯•æ€»ç»“</a> <a href="/tags/é¡¹ç›®æ€»ç»“/" style="font-size: 10.91px;">é¡¹ç›®æ€»ç»“</a> <a href="/tags/é¡¹ç›®æ„å»º/" style="font-size: 10.91px;">é¡¹ç›®æ„å»º</a> <a href="/tags/é¡¹ç›®éƒ¨ç½²/" style="font-size: 11.36px;">é¡¹ç›®éƒ¨ç½²</a> <a href="/tags/é»‘è‹¹æœ/" style="font-size: 10px;">é»‘è‹¹æœ</a>
    </div>
    
  </div>

  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">æ–‡ç« åˆ†ç±»</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/ACM/">ACM</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Android/">Android</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/C/">C++</a>
          <span class="category-list-count">16</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/CUDA/">CUDA</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Chromeæ‰©å±•/">Chromeæ‰©å±•</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/ClickHouse/">ClickHouse</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Docker/">Docker</a>
          <span class="category-list-count">25</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Dolt/">Dolt</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Dubbo/">Dubbo</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/ElasticSearch/">ElasticSearch</a>
          <span class="category-list-count">8</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Electron/">Electron</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Git/">Git</a>
          <span class="category-list-count">6</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Github/">Github</a>
          <span class="category-list-count">5</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Golang/">Golang</a>
          <span class="category-list-count">31</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/GraalVM/">GraalVM</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/IOåŸºç¡€/">IOåŸºç¡€</a>
          <span class="category-list-count">4</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Java/">Java</a>
          <span class="category-list-count">4</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Javaæºç /">Javaæºç </a>
          <span class="category-list-count">16</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/JuiceFS/">JuiceFS</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Kubernetes/">Kubernetes</a>
          <span class="category-list-count">12</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Life/">Life</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Linux/">Linux</a>
          <span class="category-list-count">16</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Maven/">Maven</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/MongoDB/">MongoDB</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/MySQL/">MySQL</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Mybatis/">Mybatis</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/NPM/">NPM</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Netty/">Netty</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Nginx/">Nginx</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Node-js/">Node.js</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/PostgreSQL/">PostgreSQL</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Protobuf/">Protobuf</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Python/">Python</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Redash/">Redash</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Docker/Redis/">Redis</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Ruby/">Ruby</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Rust/">Rust</a>
          <span class="category-list-count">35</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Spring/">Spring</a>
          <span class="category-list-count">5</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/TOML/">TOML</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/TypeScript/">TypeScript</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Websocket/">Websocket</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/äººå·¥æ™ºèƒ½/">äººå·¥æ™ºèƒ½</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/äººç”Ÿæ—¥è®°/">äººç”Ÿæ—¥è®°</a>
          <span class="category-list-count">27</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/åˆ†å¸ƒå¼/">åˆ†å¸ƒå¼</a>
          <span class="category-list-count">10</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/åŠå…¬/">åŠå…¬</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/åšå®¢ç®¡ç†/">åšå®¢ç®¡ç†</a>
          <span class="category-list-count">6</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Mybatis/æŠ€æœ¯æ‚è°ˆ/å­¦ä¹ æ¡ˆä¾‹/">å­¦ä¹ æ¡ˆä¾‹</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/å·¥å…·åˆ†äº«/">å·¥å…·åˆ†äº«</a>
          <span class="category-list-count">41</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/å¹¶å‘ç¼–ç¨‹/">å¹¶å‘ç¼–ç¨‹</a>
          <span class="category-list-count">13</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Mybatis/æŠ€æœ¯æ‚è°ˆ/">æŠ€æœ¯æ‚è°ˆ</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/æ•™å¸ˆ/">æ•™å¸ˆ</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/æ•°æ®åº“/">æ•°æ®åº“</a>
          <span class="category-list-count">8</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/æ—¥æœ¬èª/">æ—¥æœ¬èª</a>
          <span class="category-list-count">11</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/æœåŠ¡è‡ªå»º/">æœåŠ¡è‡ªå»º</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/æ±‡ç¼–è¯­è¨€/">æ±‡ç¼–è¯­è¨€</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/ç®—æ³•/">ç®—æ³•</a>
          <span class="category-list-count">5</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/ç®—æ³•é¢˜ç›®/">ç®—æ³•é¢˜ç›®</a>
          <span class="category-list-count">60</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/è¯¾ç¨‹/">è¯¾ç¨‹</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/Redis/è½¯ä»¶å®‰è£…ä¸é…ç½®/">è½¯ä»¶å®‰è£…ä¸é…ç½®</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/è½¯ä»¶æµ‹è¯•/">è½¯ä»¶æµ‹è¯•</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/è½¯è€ƒ/">è½¯è€ƒ</a>
          <span class="category-list-count">1</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/é¢è¯•æ€»ç»“/">é¢è¯•æ€»ç»“</a>
          <span class="category-list-count">15</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/é¡¹ç›®æ€»ç»“/">é¡¹ç›®æ€»ç»“</a>
          <span class="category-list-count">3</span>
        </li>

        
      </ul>

    </div>
  </div>


  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">æœ€æ–°æ–‡ç« </h3>
    <div class="nexmoe-widget">
      <ul>
        
          <li>
            <a href="/2026/02/10/å†è§2025ï¼Œä½ å¥½2026ï¼/">å†è§2025ï¼Œä½ å¥½2026ï¼</a>
          </li>
        
          <li>
            <a href="/2025/08/20/ä¸‹ä¸€ä»£æç¤ºè¯å·¥ç¨‹è¯­è¨€POMLç®€æ˜æ•™ç¨‹/">ä¸‹ä¸€ä»£æç¤ºè¯å·¥ç¨‹è¯­è¨€POMLç®€æ˜æ•™ç¨‹</a>
          </li>
        
          <li>
            <a href="/2025/07/30/å¼€äº†ä¸€ä¸ªæ–°çš„ä¸“é—¨å­¦ä¹ æ—¥è¯­çš„åšå®¢/">å¼€äº†ä¸€ä¸ªæ–°çš„ä¸“é—¨å­¦ä¹ æ—¥è¯­çš„åšå®¢</a>
          </li>
        
          <li>
            <a href="/2025/07/29/ä¸€ã€å¹¶è¡Œç¼–ç¨‹å¯¼è®ºä¸CUDAå…¥é—¨/">ä¸€ã€å¹¶è¡Œç¼–ç¨‹å¯¼è®ºä¸CUDAå…¥é—¨</a>
          </li>
        
          <li>
            <a href="/2025/07/24/ä¸€äº›å…è´¹çš„GPUèµ„æº/">ä¸€äº›å…è´¹çš„GPUèµ„æº</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
    <div class="nexmoe-copyright">
        <span style="color:#707070;font-size: 14px;">
            æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡ <br>
            æœ¬ç«™è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>äººæ¬¡ <br>
        </span>
        <span id="showsectime" style="color:#707070;font-size: 14px;">
            æœ¬ç«™å·²è¿è¡Œ0å¤©0å°æ—¶0åˆ†0ç§’
        </span>
        <i class="fa fa-heart throb" style="color:#d43f57">â¤</i><br>

        &copy; 2026 Jasonkay
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://nexmoe.com/hexo-theme-nexmoe.html" target="_blank">Nexmoe</a>
    </div>

    <div id="footer-info">

    </div>

    <script type="text/javascript">
        function NewDate(str) {
            str = str.split('-');
            var date = new Date();
            date.setUTCFullYear(str[0], str[1] - 1, str[2]);
            date.setUTCHours(0, 0, 0, 0);
            return date;
        }
        function showsectime() {
            var birthDay = NewDate("2019-09-01");
            var today = new Date();
            var timeold = today.getTime() - birthDay.getTime();
            var sectimeold = timeold / 1000
            var secondsold = Math.floor(sectimeold);
            var msPerDay = 24 * 60 * 60 * 1000; var e_daysold = timeold / msPerDay;
            var daysold = Math.floor(e_daysold);
            var e_hrsold = (daysold - e_daysold) * -24;
            var hrsold = Math.floor(e_hrsold);
            var e_minsold = (hrsold - e_hrsold) * -60;
            var minsold = Math.floor((hrsold - e_hrsold) * -60); var seconds = Math.floor((minsold - e_minsold) * -60).toString();
            document.getElementById("showsectime").innerHTML = "æœ¬ç«™å·²è¿è¡Œ" + daysold + "å¤©" + hrsold + "å°æ—¶" + minsold + "åˆ†" + seconds + "ç§’";
            setTimeout(showsectime, 1000);
        }
        showsectime();
    </script>

</div><!-- .nexmoe-drawer -->
  </div>
  <div id="nexmoe-content">
    <div class="nexmoe-primary">
      <div class="nexmoe-post">
  <div class="nexmoe-post-cover">
    
    <img src="https://img.paulzzh.com/touhou/random?99">
    
    <h1>ã€ç¿»è¯‘ã€‘Goå†…å­˜æ¨¡å‹</h1>
  </div>
  <div class="nexmoe-post-meta">
    <a><i class="nexmoefont icon-calendar-fill"></i>2022å¹´10æœˆ26æ—¥</a>
    <a><i class="nexmoefont icon-areachart"></i>11.6k å­—</a>
    <a><i class="nexmoefont icon-areachart"></i><span class="archive-article-date">é˜…è¯»é‡<span id="busuanzi_value_page_pv"></span>
      </span></a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>å¤§æ¦‚ 57 åˆ†é’Ÿ</a>

    
    <a class="nexmoefont icon-appstore-fill -link" href="/categories/Golang/">Golang</a>
    
    
    <a class="nexmoefont icon-tag-fill -link" href="/tags/Golang/">Golang</a>
    
  </div>
  <article>
    
    <div id="toc" class="toc-article">
      <ul class="markdownIt-TOC">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ã€ç¿»è¯‘ã€‘Goå†…å­˜æ¨¡å‹"><span class="toc-text">ã€ç¿»è¯‘ã€‘Goå†…å­˜æ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#å‰è¨€"><span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä»‹ç»-Introduction"><span class="toc-text">ä»‹ç»(Introduction)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#å»ºè®®-Advice"><span class="toc-text">å»ºè®®(Advice)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ­£å¼å¼€å§‹å‰çš„ç¢ç¢å¿µ-Informal-Overview"><span class="toc-text">æ­£å¼å¼€å§‹å‰çš„ç¢ç¢å¿µ(Informal Overview)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å†…å­˜æ¨¡å‹-Memory-Model"><span class="toc-text">å†…å­˜æ¨¡å‹(Memory Model)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å«æœ‰data-raceçš„ä»£ç å®ç°çš„é™åˆ¶"><span class="toc-text">å«æœ‰data-raceçš„ä»£ç å®ç°çš„é™åˆ¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#åŒæ­¥ï¼ˆSynchronizationï¼‰"><span class="toc-text">åŒæ­¥ï¼ˆSynchronizationï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#åˆå§‹åŒ–ï¼ˆInitializationï¼‰"><span class="toc-text">åˆå§‹åŒ–ï¼ˆInitializationï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#åˆ›å»ºGoroutineï¼ˆGoroutine-creationï¼‰"><span class="toc-text">åˆ›å»ºGoroutineï¼ˆGoroutine creationï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#é”€æ¯Goroutineï¼ˆGoroutine-destructionï¼‰"><span class="toc-text">é”€æ¯Goroutineï¼ˆGoroutine destructionï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Channelé€šä¿¡ï¼ˆChannel-communicationï¼‰"><span class="toc-text">Channelé€šä¿¡ï¼ˆChannel communicationï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#æ— ç¼“å­˜Channel"><span class="toc-text">æ— ç¼“å­˜Channel</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#æœ‰ç¼“å­˜Channel"><span class="toc-text">æœ‰ç¼“å­˜Channel</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Locks"><span class="toc-text">Locks</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Once"><span class="toc-text">Once</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Atomic-Values"><span class="toc-text">Atomic Values</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Finalizers"><span class="toc-text">Finalizers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Additional-Mechanisms"><span class="toc-text">Additional Mechanisms</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸æ­£ç¡®çš„åŒæ­¥ï¼ˆIncorrect-synchronizationï¼‰"><span class="toc-text">ä¸æ­£ç¡®çš„åŒæ­¥ï¼ˆIncorrect synchronizationï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ç¼–è¯‘ç›¸å…³çš„é”™è¯¯ï¼ˆIncorrect-compilationï¼‰"><span class="toc-text">ç¼–è¯‘ç›¸å…³çš„é”™è¯¯ï¼ˆIncorrect compilationï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ€»ç»“"><span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#é™„å½•"><span class="toc-text">é™„å½•</span></a></li></ol>
      </ul>
    </div>
    
    <p>MITçš„Lecture5è¦æ±‚å…ˆé˜…è¯»Goå†…å­˜æ¨¡å‹ï¼Œè¿™ç¯‡æ–‡ç« å†™çš„æŒºå¥½çš„ï¼Œæ‰€ä»¥æ‰“ç®—ç¿»è¯‘ä¸€ä¸‹ï¼›</p>
<p>åŸæ–‡åœ°å€ï¼š</p>
<ul>
<li><a href="https://go.dev/ref/mem" target="_blank" rel="noopener">https://go.dev/ref/mem</a></li>
</ul>
<p>æºä»£ç ï¼š</p>
<ul>
<li><a href="https://github.com/JasonkayZK/go-learn/tree/go-memory-model" target="_blank" rel="noopener">https://github.com/JasonkayZK/go-learn/tree/go-memory-model</a></li>
</ul>
<br>

<a id="more"></a>

<h1 id="ã€ç¿»è¯‘ã€‘Goå†…å­˜æ¨¡å‹"><a href="#ã€ç¿»è¯‘ã€‘Goå†…å­˜æ¨¡å‹" class="headerlink" title="ã€ç¿»è¯‘ã€‘Goå†…å­˜æ¨¡å‹"></a><strong>ã€ç¿»è¯‘ã€‘Goå†…å­˜æ¨¡å‹</strong></h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a><strong>å‰è¨€</strong></h2><p><strong>æœ¬æ–‡æ˜¯åŸºäº <code>Version of June 6, 2022</code> ç¿»è¯‘ï¼›</strong></p>
<p>ä¹‹å‰åœ¨ç½‘ä¸Šæ‰¾äº†ä¸å°‘å…³äº <code>The Go Memory Model</code> çš„ç¿»è¯‘ï¼Œå¤§å¤šæ•°éƒ½æ˜¯æ¯”è¾ƒè€çš„ç‰ˆæœ¬ï¼›</p>
<p>è€Œæ–°ç‰ˆæœ¬åŠ äº†ä¸å°‘çš„å†…å®¹ï¼Œæ‰€ä»¥æƒ³è¦å†ç¿»è¯‘ä¸€ä¸‹ï¼›</p>
<p><strong>æœ¬æ–‡ç»“åˆäº†æˆ‘ä¸ªäººçš„ä¸€äº›ç†è§£ï¼Œå¦‚æœæœ‰ç¿»è¯‘ä¸å¯¹çš„åœ°æ–¹ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶èƒ½å¤Ÿåœ¨ä¸‹æ–¹è¯„è®ºåŒºæŒ‡å‡ºï¼</strong></p>
<br>

<h2 id="ä»‹ç»-Introduction"><a href="#ä»‹ç»-Introduction" class="headerlink" title="ä»‹ç»(Introduction)"></a><strong>ä»‹ç»(Introduction)</strong></h2><blockquote>
<p>  The Go memory model specifies the conditions under which reads of a variable in one goroutine can be guaranteed to observe values produced by writes to the same variable in a different goroutine.</p>
</blockquote>
<p>Goå†…å­˜æ¨¡å‹ç‰¹åˆ«æŒ‡å®šäº†ä¸€äº›æ¡ä»¶ï¼Œåœ¨è¿™äº›æ¡ä»¶ä¸‹å¯ä»¥ä¿è¯åœ¨ä¸€ä¸ª goroutine ä¸­å¯ä»¥è§‚å¯Ÿï¼ˆè¯»å–ï¼‰åˆ°å…¶ä»– goroutine ä¸­å¯¹ç›¸åŒå˜é‡çš„å†™å…¥çš„å€¼ï¼›</p>
<h3 id="å»ºè®®-Advice"><a href="#å»ºè®®-Advice" class="headerlink" title="å»ºè®®(Advice)"></a><strong>å»ºè®®(Advice)</strong></h3><blockquote>
<p>Programs that modify data being simultaneously accessed by multiple goroutines must serialize such access.</p>
<p>To serialize access, protect the data with channel operations or other synchronization primitives such as those in the <a href="https://go.dev/pkg/sync/" target="_blank" rel="noopener"><code>sync</code></a> and <a href="https://go.dev/pkg/sync/atomic/" target="_blank" rel="noopener"><code>sync/atomic</code></a> packages.</p>
<p>If you must read the rest of this document to understand the behavior of your program, you are being too clever.</p>
<p>Donâ€™t be clever.</p>
</blockquote>
<p>ä»£ç ä¸­å¦‚æœå­˜åœ¨å¤šä¸ª Goroutine åŒæ—¶è®¿é—®å¹¶ä¿®æ”¹åŒä¸€ä¸ªæ•°æ®çš„åœºæ™¯ï¼Œåˆ™å¿…é¡»ï¼ˆé‡‡ç”¨åŒæ­¥çš„æ–¹å¼ï¼‰åºåˆ—åŒ–è¿™äº›æ“ä½œï¼›</p>
<p>ä¸ºäº†åºåˆ—åŒ–è®¿é—®è¿™äº›å…±äº«çš„æ•°æ®ï¼Œå¯ä»¥é‡‡ç”¨ Channel æ“ä½œæˆ–è€…å…¶ä»–åŒæ­¥åŸè¯­ï¼Œæ¯”å¦‚ï¼š<a href="https://go.dev/pkg/sync/" target="_blank" rel="noopener"><code>sync</code></a> å’Œ <a href="https://go.dev/pkg/sync/atomic/" target="_blank" rel="noopener"><code>sync/atomic</code></a> åŒ…æä¾›çš„åŠŸèƒ½ï¼›</p>
<p>å¦‚æœä½ é€‰æ‹©äº†é˜…è¯»è¿™ç¯‡æ–‡æ¡£å‰©ä¸‹çš„å†…å®¹æ¥äº†è§£ä½ çš„ä»£ç åˆ°åº•æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œé‚£ä½ çš„é€‰æ‹©æ˜¯æ˜æ™ºçš„ï¼</p>
<p>ä¸è¦è‡ªä½œèªæ˜ï¼</p>
<blockquote>
<p>  <strong>æ€»ç»“ï¼šä½ è§‰å¾—ä½ è‡ªå·±æ‡‚äº†ï¼Œæˆ‘è§‰å¾—ä½ æ²¡æ‡‚ï¼›233</strong></p>
</blockquote>
<h3 id="æ­£å¼å¼€å§‹å‰çš„ç¢ç¢å¿µ-Informal-Overview"><a href="#æ­£å¼å¼€å§‹å‰çš„ç¢ç¢å¿µ-Informal-Overview" class="headerlink" title="æ­£å¼å¼€å§‹å‰çš„ç¢ç¢å¿µ(Informal Overview)"></a><strong>æ­£å¼å¼€å§‹å‰çš„ç¢ç¢å¿µ(Informal Overview)</strong></h3><blockquote>
<p>  Go approaches its memory model in much the same way as the rest of the language, aiming to keep the semantics simple, understandable, and useful. This section gives a general overview of the approach and should suffice for most programmers. The memory model is specified more formally in the next section.</p>
</blockquote>
<p>Go åœ¨å®ç°ä»–è‡ªå·±çš„å†…å­˜æ¨¡å‹æ—¶ï¼Œå’Œå…¶ä»–å¤§å¤šæ•°çš„ç¼–ç¨‹è¯­è¨€ååˆ†ç±»ä¼¼ï¼Œç›®çš„æ˜¯ä¸ºäº†ä¿è¯è¯­ä¹‰çš„ç®€å•ã€å¥½ç†è§£å¹¶ä¸”å¥½ç”¨ï¼›è¿™ä¸€å°èŠ‚ç»™å‡ºäº†ä¸€ä¸ª Go å†…å­˜æ¨¡å‹å®ç°çš„æ€»ä½“æ¦‚è¿°ï¼Œä½†æ˜¯è¶³ä»¥æ»¡è¶³å¤§å¤šæ•°å¼€å‘è€…çš„çŸ¥è¯†éœ€è¦äº†ï¼›åœ¨ä¸‹ä¸€å°èŠ‚ä¸­ä¼šæ›´åŠ æ·±å…¥çš„æ¢è®¨å†…å­˜æ¨¡å‹ï¼›</p>
<blockquote>
<p>  A <em>data race</em> is defined as a write to a memory location happening concurrently with another read or write to that same location, unless all the accesses involved are atomic data accesses as provided by the <code>sync/atomic</code> package. As noted already, programmers are strongly encouraged to use appropriate synchronization to avoid data races. In the absence of data races, Go programs behave as if all the goroutines were multiplexed onto a single processor. This property is sometimes referred to as DRF-SC: data-race-free programs execute in a sequentially consistent manner.</p>
</blockquote>
<blockquote>
<p>  <strong><code>data race</code>ï¼šæ•°æ®ç«äº‰ï¼ŒæŒ‡çš„æ˜¯å¤šä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®æŸä¸€å…±äº«æ•°æ®ä»è€Œå¯èƒ½é€ æˆå¹¶å‘é—®é¢˜ï¼Œä¸‹æ–‡å°†ä½¿ç”¨åŸå•è¯ï¼›</strong></p>
</blockquote>
<p><code>data race</code> æŒ‡çš„æ˜¯åœ¨å‘å†…å­˜çš„æŸä¸€åœ°å€å†™å…¥æ•°æ®çš„åŒæ—¶ï¼Œå­˜åœ¨å…¶ä»–çº¿ç¨‹å¹¶å‘çš„åœ¨åŒä¸€å†…å­˜åœ°å€è¿›è¡Œè¯»å–æˆ–å†™å…¥æ“ä½œï¼›æ‰€æœ‰ä¸Šè¿°æ¶‰åŠåˆ°æ•°æ®è®¿é—®çš„æ“ä½œéƒ½æ˜¯ç”±  <code>sync/atomic</code> åŒ…æä¾›çš„åŸå­æ“ä½œé™¤å¤–ï¼</p>
<p>æ­£å¦‚å‰æ–‡æåˆ°çš„ï¼Œæˆ‘ä»¬å¼ºçƒˆæ¨èå¼€å‘è€…ä½¿ç”¨åˆé€‚çš„åŒæ­¥ç­–ç•¥ï¼ˆå¦‚ï¼Œé”ã€Channelç­‰ï¼‰æ¥é¿å… data raceï¼›</p>
<p>åœ¨æ²¡æœ‰ data race çš„åœºæ™¯ä¸‹ï¼ŒGo ç¨‹åºè¡¨ç°çš„å°±åƒæ˜¯æ‰€æœ‰çš„ goroutine è¢«åŒä¸€ä¸ªå¤„ç†å™¨è¿›è¡Œå¤šè·¯è°ƒåº¦ä¸€æ ·ï¼ˆ<code>all the goroutines were multiplexed onto a single processor</code>ï¼‰ï¼›</p>
<p>è¿™ç§ç‰¹æ€§æœ‰æ—¶ä¹Ÿè¢«ç§°ä½œä¸º <code>DRF-SC</code>ï¼šæ—  data race çš„ç¨‹åºä»¥é¡ºåºä¸€è‡´çš„æ–¹å¼æ‰§è¡Œï¼ˆdata-race-free programs execute in a sequentially consistent mannerï¼‰ï¼›</p>
<blockquote>
<p>  While programmers should write Go programs without data races, there are limitations to what a Go implementation can do in response to a data race. An implementation may always react to a data race by reporting the race and terminating the program. Otherwise, each read of a single-word-sized or sub-word-sized memory location must observe a value actually written to that location (perhaps by a concurrent executing goroutine) and not yet overwritten. These implementation constraints make Go more like Java or JavaScript, in that most races have a limited number of outcomes, and less like C and C++, where the meaning of any program with a race is entirely undefined, and the compiler may do anything at all. Goâ€™s approach aims to make errant programs more reliable and easier to debug, while still insisting that races are errors and that tools can diagnose and report them.</p>
</blockquote>
<p>è™½ç„¶å¼€å‘è€…åº”å½“åœ¨æ²¡æœ‰ data race çš„æƒ…å†µä¸‹ç¼–å†™ Go ä»£ç ï¼Œä½†æ˜¯ Go çš„å®ç°å®é™…ä¸Šé™åˆ¶äº†è¿™ä¸€ç‚¹ï¼ˆä½¿å¾—ä½ ä¸å¾—ä¸å…³æ³¨ å¹¶è§£å†³ data race é—®é¢˜ï¼‰ï¼›</p>
<blockquote>
<p>  <strong>æˆ‘çŒœè¿™é‡Œä½œè€…çš„æ„æ€æ˜¯åƒC++è¿™ç§è¯­è¨€ä¸ä¼šé™åˆ¶ä½ å»å¤„ç† data race å¼€å‘è€…ä¸éœ€è¦å…³å¿ƒ data race ä»£ç ä¹Ÿèƒ½è·‘ï¼Œä½†æ˜¯å¯¹ä¸å¯¹å°±æ˜¯ä½ è‡ªå·±çš„äº‹æƒ…äº†ï½</strong></p>
</blockquote>
<p>ä¸€ä¸ªï¼ˆå¥½çš„ï¼‰å®ç°åº”è¯¥æ€»æ˜¯èƒ½å¯Ÿè§‰å¹¶å¯¹ data race åšå‡ºååº”ï¼Œæ¯”å¦‚ï¼šæŠ¥é”™è¯´å­˜åœ¨ data race å¹¶ä¸”ç»ˆæ­¢ç¨‹åºè¿è¡Œï¼›</p>
<p>å¦åˆ™ï¼Œæ¯æ¬¡åœ¨å†…å­˜åœ°å€ä¸­è¯»å–ä¸€ä¸ªå­—æˆ–è€…ä¸€ä¸ªå­—èŠ‚çš„æ—¶å€™ï¼Œå¿…é¡»ç¡®ä¿ï¼ˆè§‚å¯Ÿåˆ°ï¼‰è¿™ä¸ªå€¼ç¡®å®è¢«å†™å…¥åˆ°äº†å†…å­˜çš„è¿™ä¸ªåœ°æ–¹ï¼ˆå¯èƒ½æ˜¯è¢«å¤šä¸ª goroutine å¹¶å‘å†™å…¥ï¼‰ï¼Œå¹¶ä¸”è¿™ä¸ªå€¼è¿˜æ²¡æœ‰è¢«ï¼ˆå…¶ä»– goroutineï¼‰è¦†ç›–ï¼›</p>
<p>æ­£æ˜¯è¿™äº›å®ç°çš„çº¦æŸï¼Œä½¿å¾— Go å’Œ Java æˆ–è€… JavaScript éå¸¸ç±»ä¼¼ï¼Œå³ï¼šå¤§å¤šæ•°çš„ data race åªä¼šé€ æˆä¸æ˜¯å¾ˆä¸¥é‡çš„åæœï¼ˆhave a limited number of outcomesï¼‰ï¼›</p>
<p>è€Œä¸åƒ C å’Œ C++ï¼ˆç‚¹åè¡¨æ‰¬ï¼ï¼‰ï¼Œdata race ä¼šé€ æˆæœªå®šä¹‰çš„è¡Œä¸ºï¼Œå¹¶ä¸”ç¼–è¯‘å™¨ï¼ˆå°¤å…¶æ˜¯ä»£ç ä¼˜åŒ–é˜¶æ®µï¼‰å¯èƒ½ä¼šåšå„ç§å„æ ·ç¦»è°±çš„äº‹ï¼</p>
<p>Go çš„å®ç°ç›®çš„æ˜¯è®©çŠ¯é”™è¯¯çš„ç¨‹åºä¹Ÿèƒ½å¤Ÿå°½é‡å¯é ï¼Œå¹¶ä¸”å®¹æ˜“ debugï¼Œå¹¶ä¸”ä¹ŸåšæŒï¼š data race å°±æ˜¯é”™è¯¯ï¼Œåº”å½“æä¾›ç›¸åº”çš„å·¥å…·æ¥è¯Šæ–­å¹¶æŠ¥å‘Šè¿™äº›é”™è¯¯ï¼›</p>
<br>

<h2 id="å†…å­˜æ¨¡å‹-Memory-Model"><a href="#å†…å­˜æ¨¡å‹-Memory-Model" class="headerlink" title="å†…å­˜æ¨¡å‹(Memory Model)"></a><strong>å†…å­˜æ¨¡å‹(Memory Model)</strong></h2><blockquote>
<p>  The following formal definition of Goâ€™s memory model closely follows the approach presented by Hans-J. Boehm and Sarita V. Adve in â€œ<a href="https://www.hpl.hp.com/techreports/2008/HPL-2008-56.pdf" target="_blank" rel="noopener">Foundations of the C++ Concurrency Memory Model</a>â€, published in PLDI 2008. The definition of data-race-free programs and the guarantee of sequential consistency for race-free programs are equivalent to the ones in that work.</p>
</blockquote>
<p>Go ä¸­å†…å­˜æ¨¡å‹çš„å®šä¹‰ä¸ <code>Hans-J. Boehm</code> å’Œ <code>Sarita V. Adve</code> åœ¨2008å¹´å‘è¡¨åœ¨ PLDI ä¸Šçš„è®ºæ–‡ <a href="https://www.hpl.hp.com/techreports/2008/HPL-2008-56.pdf" target="_blank" rel="noopener">Foundations of the C++ Concurrency Memory Model</a> å†…å®¹éå¸¸æ¥è¿‘ï¼›åŒæ—¶ï¼Œå…³äºç¦æ­¢ data-raceï¼ˆ<code>data-race-free</code>ï¼‰å’Œä¿è¯åœ¨ç¦æ­¢æ•°æ®ç«äº‰ï¼ˆ<code>race-free</code>ï¼‰ç¨‹åºä¸­é¡ºåºä¸€è‡´æ€§çš„æè¿°å’Œè®ºæ–‡å†…å®¹å®Œå…¨ä¸€è‡´ã€‚</p>
<blockquote>
<p>  The memory model describes the requirements on program executions, which are made up of goroutine executions, which in turn are made up of memory operations.</p>
<p>  A <em>memory operation</em> is modeled by four details:</p>
<ul>
<li>its kind, indicating whether it is an ordinary data read, an ordinary data write, or a <em>synchronizing operation</em> such as an atomic data access, a mutex operation, or a channel operation,</li>
<li>its location in the program,</li>
<li>the memory location or variable being accessed, and</li>
<li>the values read or written by the operation.</li>
</ul>
</blockquote>
<p><strong>å†…å­˜æ¨¡å‹æè¿°äº†ä»£ç æ‰§è¡Œçš„åŸºæœ¬éœ€æ±‚ï¼šGo çš„æ‰§è¡Œæ˜¯ç”±å¤§é‡ goroutine æ‰§è¡Œç»„æˆï¼Œå½“ç„¶æœ€ç»ˆè¿™äº›æ‰§è¡Œéƒ½ä¼šè½¬åŒ–ä¸ºå†…å­˜æ“ä½œï¼›</strong></p>
<p>å†…å­˜æ“ä½œçš„å»ºæ¨¡ç»†èŠ‚å¦‚ä¸‹ï¼ˆå†…å­˜æ¨¡å‹å®šä¹‰ï¼‰ï¼š</p>
<ul>
<li><strong>å†…å­˜æ“ä½œç±»å‹</strong>ï¼šè¡¨ç¤ºè¿™ä¸ªå†…å­˜æ“ä½œæ˜¯ï¼šæ™®é€šè¯»æ•°æ®ã€æ™®é€šå†™æ•°æ®ã€æˆ–è€…æ˜¯ä¸€ä¸ªåŒæ­¥æ“ä½œï¼Œå¦‚ï¼šåŸå­æ•°æ®è®¿é—®ã€äº’æ–¥é”æ“ä½œã€Channel æ“ä½œç­‰ï¼›</li>
<li>æ“ä½œæœ¬èº«åœ¨ä»£ç ä¸­çš„ä½ç½®ï¼›</li>
<li>éœ€è¦æ“ä½œçš„å†…å­˜åœ°å€ã€æˆ–æ­£åœ¨è¢«è®¿é—®çš„å˜é‡å’Œï¼›</li>
<li>å¯¹åº”çš„æ­£åœ¨è¢«æ“ä½œè¯»å–æˆ–å†™å…¥çš„å€¼ï¼›</li>
</ul>
<blockquote>
<p>  Some memory operations are <em>read-like</em>, including read, atomic read, mutex lock, and channel receive. Other memory operations are <em>write-like</em>, including write, atomic write, mutex unlock, channel send, and channel close. Some, such as atomic compare-and-swap, are both read-like and write-like.</p>
</blockquote>
<p>ä¸€äº›æ“ä½œæ˜¯å…·æœ‰ <code>å†™ç‰¹æ€§çš„</code>ï¼ˆ<code>read-like</code>ï¼‰ï¼ŒåŒ…æ‹¬ï¼šè¯»ã€åŸå­è¯»ã€äº’æ–¥é”å’Œ Channel æ¥æ”¶æ¶ˆæ¯ï¼›</p>
<p>ä¸€äº›æ“ä½œæ˜¯ <code>è¯»ç‰¹æ€§çš„</code>ï¼ˆ<code>write-line</code>ï¼‰ï¼ŒåŒ…æ‹¬ï¼šå†™ã€åŸå­å†™ã€è§£äº’æ–¥é”ã€Channel å‘é€æ¶ˆæ¯ å’Œ å…³é—­ Channelï¼›</p>
<p>è¿˜æœ‰ä¸€äº›ç‰¹æ€§æ˜¯åŒæ—¶å…·æœ‰ä¸¤ç§å±æ€§çš„ï¼Œæ¯”å¦‚ï¼šåŸå­çš„CASï¼ˆatomic compare-and-swapï¼‰æ“ä½œï¼›</p>
<blockquote>
<p>  <strong>CAS æ“ä½œé¦–å…ˆè¦æ¯”è¾ƒå€¼ï¼ˆReadï¼‰ï¼Œç„¶åå†äº¤æ¢å†™å…¥ï¼ˆWriteï¼‰ï¼›</strong></p>
</blockquote>
<blockquote>
<p>  A <em>goroutine execution</em> is modeled as a set of memory operations executed by a single goroutine.</p>
</blockquote>
<p><strong>è€Œ Goroutine çš„æ‰§è¡Œä¼šè¢«æŠ½è±¡ä¸ºç”±å•ä¸ª Goroutine æ‰§è¡Œçš„ä¸€ç»„å†…å­˜æ“ä½œï¼›</strong></p>
<br>

<blockquote>
<p>  <strong>Requirement 1</strong>: The memory operations in each goroutine must correspond to a correct sequential execution of that goroutine, given the values read from and written to memory. That execution must be consistent with the <em>sequenced before</em> relation, defined as the partial order requirements set out by the <a href="https://go.dev/ref/spec" target="_blank" rel="noopener">Go language specification</a> for Goâ€™s control flow constructs as well as the <a href="https://go.dev/ref/spec#Order_of_evaluation" target="_blank" rel="noopener">order of evaluation for expressions</a>.</p>
<p>  A Go <em>program execution</em> is modeled as a set of goroutine executions, together with a mapping <em>W</em> that specifies the write-like operation that each read-like operation reads from. (Multiple executions of the same program can have different program executions.)</p>
</blockquote>
<p><strong>è¦æ±‚1</strong>ï¼šç»™å®šä»å†…å­˜è¯»å–å’Œå†™å…¥çš„å€¼ï¼Œæ¯ä¸ªgoroutineä¸­çš„å†…å­˜æ“ä½œå¿…é¡»å¯¹åº”äºè¯¥goroutinçš„æ­£ç¡®é¡ºåºæ‰§è¡Œï¼›è¯¥æ‰§è¡Œå¿…é¡»ä¸ä¹‹å‰çš„é¡ºåºå…³ç³»ï¼ˆ<em>sequenced before</em>ï¼‰ä¿æŒä¸€è‡´ï¼Œè¿™ä¸ªéƒ¨åˆ†é¡ºåºçš„è¦æ±‚ï¼ˆ<code>the partial order requirements</code>ï¼‰åœ¨ <a href="https://go.dev/ref/spec" target="_blank" rel="noopener">Go language specification</a>ï¼ˆæˆ–è€… <a href="https://go.dev/ref/spec#Order_of_evaluation" target="_blank" rel="noopener">order of evaluation for expressions</a>ï¼‰ä¸­è¢«å®šä¹‰ä¸º Goçš„æ§åˆ¶æµç»“æ„ï¼›</p>
<p>Go ç¨‹åºæ‰§è¡Œè¢«æŠ½è±¡ä¸ºä¸€ç»„ goroutine çš„æ‰§è¡Œï¼Œä»¥åŠä¸€ä¸ªæŠ½è±¡æ˜ å°„ <em>W</em>ï¼šè¡¨ç¤ºæ¯ä¸ªè¯»ç‰¹æ€§çš„æ“ä½œéƒ½ç”¨æ¥è¯»å–çš„å†™ç‰¹æ€§çš„æ“ä½œï¼›ï¼ˆåŒä¸€ä¸ªç¨‹åºçš„å¤šæ¬¡æ‰§è¡Œå¯ä»¥ç”±ä¸åŒçš„ç¨‹åºæ‰§è¡Œï¼‰ï¼›</p>
<blockquote>
<p>  <strong>è¿™é‡Œè¯´çš„æ˜¯ç”±å“ªä¸ª goroutine æ‰§è¡Œæ˜¯ä¸ç¡®å®šçš„ï¼Ÿ</strong></p>
</blockquote>
<blockquote>
<p>  <strong>Requirement 2</strong>: For a given program execution, the mapping <em>W</em>, when limited to synchronizing operations, must be explainable by some implicit total order of the synchronizing operations that is consistent with sequencing and the values read and written by those operations.</p>
<p>  The <em>synchronized before</em> relation is a partial order on synchronizing memory operations, derived from <em>W</em>. If a synchronizing read-like memory operation <em>r</em> observes a synchronizing write-like memory operation <em>w</em> (that is, if <em>W</em>(<em>r</em>) = <em>w</em>), then <em>w</em> is synchronized before <em>r</em>. Informally, the synchronized before relation is a subset of the implied total order mentioned in the previous paragraph, limited to the information that <em>W</em> directly observes.</p>
<p>  The <em>happens before</em> relation is defined as the transitive closure of the union of the sequenced before and synchronized before relations.</p>
</blockquote>
<p><strong>è¦æ±‚2ï¼š</strong> å¯¹äºä¸€ä¸ªç»™å®šçš„æ‰§è¡Œç¨‹åºï¼Œæ˜ å°„ <em>W</em> åªæ˜¯åŒæ­¥æ“ä½œæ—¶ï¼Œå¿…é¡»ä»¥æŸç§éšå«çš„åŒæ­¥æ“ä½œçš„ä¸€è‡´æ€§é¡ºåºæ¥è§£é‡Šå’Œæ‰§è¡Œï¼Œè¯¥æ“ä½œå¿…é¡»ï¼ˆä¸ä»£ç ï¼‰é¡ºåºä¸€è‡´ï¼Œå¹¶ä¸”ï¼ˆæ¯ä¸€ä¸ªæ“ä½œæ‰§è¡Œåçš„ï¼‰å€¼æ˜¯ç”±è¿™äº›æ“ä½œè¯»å–å’Œä¿®æ”¹çš„å€¼ï¼›</p>
<p><em>synchronized before</em>ï¼ˆæ“ä½œå‰åŒæ­¥ï¼‰å…³ç³»æºè‡ªæ˜ å°„ <em>W</em>ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªåŒæ­¥å†…å­˜æ“ä½œåŸºç¡€ä¸Šçš„éƒ¨åˆ†æœ‰åºæ“ä½œã€‚</p>
<p>å¦‚æœä¸€ä¸ªè¢«åŒæ­¥åŒ–çš„è¯»ç‰¹æ€§å†…å­˜æ“ä½œ <em>r</em> è§‚å¯Ÿåˆ°äº†æ­¤æ—¶å­˜åœ¨ä¸€ä¸ªè¢«åŒæ­¥åŒ–äº†çš„å†™ç‰¹æ€§æ“ä½œ <em>w</em> ï¼ˆå³ï¼š<em>W</em>(<em>r</em>) = <em>w</em>ï¼‰ï¼Œæ­¤æ—¶ <em>w</em> å°±éœ€è¦åœ¨ <em>r</em> æ‰§è¡Œå‰è¢«åŒæ­¥ï¼ˆ<em>w</em> is synchronized before <em>r</em>ï¼‰ï¼›</p>
<p>ä¸ä¸¥æ ¼çš„è®²ï¼Œåˆšæ‰æåˆ°çš„ <em>synchronized before*ï¼ˆæ“ä½œå‰åŒæ­¥ï¼‰æ“ä½œæ˜¯å‰æ–‡ä¸­æåˆ°çš„å…¨å±€é¡ºåºæ‰§è¡Œçš„ä¸€ä¸ªå­é›†ï¼ŒåŸå› ä¸»è¦æ˜¯å—é™äºæ˜ å°„ *W</em> æ‰€èƒ½ç›´æ¥è§‚å¯Ÿåˆ°çš„ä¿¡æ¯ï¼›</p>
<p><em>happens before</em> å…³ç³»æ˜¯ï¼šé¡ºåºå‰åºæ‰§è¡Œå’ŒåŒæ­¥å‰åºæ‰§è¡Œä¸¤è€…çš„å¹¶é›†ï¼ˆthe transitive closure of the union of the sequenced before and synchronized before relations.ï¼‰ï¼›</p>
<blockquote>
<p>  <strong>Requirement 3</strong>: For an ordinary (non-synchronizing) data read <em>r</em> on a memory location <em>x</em>, <em>W</em>(<em>r</em>) must be a write <em>w</em> that is <em>visible</em> to <em>r</em>, where visible means that both of the following hold:</p>
<ol>
<li><em>w</em> happens before <em>r</em>.</li>
<li><em>w</em> does not happen before any other write <em>wâ€™</em> (to <em>x</em>) that happens before <em>r</em>.</li>
</ol>
</blockquote>
<p><strong>è¦æ±‚3ï¼š</strong> å¯¹äºä¸€ä¸ªæ™®é€šï¼ˆéåŒæ­¥ï¼‰çš„åœ¨å†…å­˜åœ°å€ <em>x</em> ä¸Šçš„è¯»å–æ“ä½œ <em>r</em>ï¼ŒW(<em>r</em>) æ“ä½œä¹Ÿå¿…é¡»è¦ä¿è¯ï¼Œå†™å…¥æ“ä½œ <em>w</em> å¯¹äºè¯»å–æ“ä½œ <em>r</em> æ˜¯å¯è§çš„ï¼Œè¿™é‡Œçš„å¯è§æ€§ä¸»è¦åŒ…æ‹¬ä¸¤ç‚¹ï¼š</p>
<ul>
<li>å†™å…¥æ“ä½œ <em>w</em> æ“ä½œå‘ç”Ÿåœ¨è¯»å–æ“ä½œ <em>r</em> ä¹‹å‰ï¼›</li>
<li>å†™å…¥æ“ä½œ <em>w</em> ä¸ä¼šå‘ç”Ÿåœ¨è¯»å–æ“ä½œ <em>r</em> ä¹‹å‰çš„ä»»ä½•å…¶ä»–å†™å…¥ <em>wâ€™</em>ï¼ˆè‡³ <em>x</em>ï¼‰ä¹‹å‰ï¼›</li>
</ul>
<blockquote>
<p>  ä¸Šé¢è¿™ä¸€æ®µä¸å¤ªå¥½ç†è§£ï¼Œæ€»çš„æ¥è¯´ä¸»è¦å°±æ˜¯è®²è¿°äº† <em>happen before</em> çš„ä¸€äº›ç‰¹æ€§ï¼Œå³ï¼Œä¸¤ä¸ªäº‹ä»¶çš„ç»“æœä¹‹é—´çš„å…³ç³»ï¼š</p>
<p>  <strong>å¦‚æœä¸€ä¸ªäº‹ä»¶åº”è¯¥åœ¨å¦ä¸€ä¸ªäº‹ä»¶ä¹‹å‰å‘ç”Ÿï¼Œåˆ™ç»“æœå¿…é¡»åæ˜ è¿™ä¸€ç‚¹ï¼Œå³ä½¿è¿™äº›äº‹ä»¶å®é™…ä¸Šæ˜¯æ— åºæ‰§è¡Œçš„ï¼ˆé€šå¸¸æ˜¯ä¸ºäº†ä¼˜åŒ–ç¨‹åºæµç¨‹ï¼‰ï¼›</strong></p>
<p>  ä¸»è¦åŒ…æ‹¬äº†ä»¥ä¸‹å…«å¤§åŸåˆ™ï¼š</p>
<ul>
<li><p><strong>å•çº¿ç¨‹happen-beforeåŸåˆ™ï¼šåœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œä¹¦å†™åœ¨å‰é¢çš„æ“ä½œhappen-beforeåé¢çš„æ“ä½œã€‚</strong></p>
</li>
<li><p><strong>é”çš„happen-beforeåŸåˆ™ï¼šåŒä¸€ä¸ªé”çš„unlockæ“ä½œhappen-beforeæ­¤é”çš„lockæ“ä½œã€‚</strong></p>
</li>
<li><p><strong>volatileçš„happen-beforeåŸåˆ™ï¼šå¯¹ä¸€ä¸ªvolatileå˜é‡çš„å†™æ“ä½œhappen-beforeå¯¹æ­¤å˜é‡çš„ä»»æ„æ“ä½œ(å½“ç„¶ä¹ŸåŒ…æ‹¬å†™æ“ä½œäº†)ã€‚</strong></p>
</li>
<li><p><strong>happen-beforeçš„ä¼ é€’æ€§åŸåˆ™ï¼šå¦‚æœAæ“ä½œ happen-before Bæ“ä½œï¼ŒBæ“ä½œhappen-before Cæ“ä½œï¼Œé‚£ä¹ˆAæ“ä½œhappen-before Cæ“ä½œã€‚</strong></p>
</li>
<li><p><strong>çº¿ç¨‹å¯åŠ¨çš„happen-beforeåŸåˆ™ï¼šåŒä¸€ä¸ªçº¿ç¨‹çš„startæ–¹æ³•happen-beforeæ­¤çº¿ç¨‹çš„å…¶å®ƒæ–¹æ³•ã€‚</strong></p>
</li>
<li><p><strong>çº¿ç¨‹ä¸­æ–­çš„happen-beforeåŸåˆ™ï¼šå¯¹çº¿ç¨‹interruptæ–¹æ³•çš„è°ƒç”¨happen-beforeè¢«ä¸­æ–­çº¿ç¨‹çš„æ£€æµ‹åˆ°ä¸­æ–­å‘é€çš„ä»£ç ã€‚</strong></p>
</li>
<li><p><strong>çº¿ç¨‹ç»ˆç»“çš„happen-beforeåŸåˆ™ï¼šçº¿ç¨‹ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½happen-beforeçº¿ç¨‹çš„ç»ˆæ­¢æ£€æµ‹ã€‚</strong></p>
</li>
<li><p><strong>å¯¹è±¡åˆ›å»ºçš„happen-beforeåŸåˆ™ï¼šä¸€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆå…ˆäºä»–çš„finalizeæ–¹æ³•è°ƒç”¨ã€‚</strong></p>
<p>æ‰©å±•é˜…è¯»ï¼š</p>
</li>
<li><p><a href="https://en.wikipedia.org/wiki/Happened-before" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Happened-before</a></p>
</li>
<li><p><a href="https://www.jianshu.com/p/1508eedba54d" target="_blank" rel="noopener">https://www.jianshu.com/p/1508eedba54d</a></p>
</li>
<li><p><a href="https://www.51cto.com/article/712408.html" target="_blank" rel="noopener">https://www.51cto.com/article/712408.html</a></p>
</li>
<li><p><a href="https://cloud.tencent.com/developer/article/1734515" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1734515</a></p>
</li>
</ul>
</blockquote>
<blockquote>
<p>  A <em>read-write data race</em> on memory location <em>x</em> consists of a read-like memory operation <em>r</em> on <em>x</em> and a write-like memory operation <em>w</em> on <em>x</em>, at least one of which is non-synchronizing, which are unordered by happens before (that is, neither <em>r</em> happens before <em>w</em> nor <em>w</em> happens before <em>r</em>).</p>
<p>  A <em>write-write data race</em> on memory location <em>x</em> consists of two write-like memory operations <em>w</em> and <em>wâ€™</em> on <em>x</em>, at least one of which is non-synchronizing, which are unordered by happens before.</p>
<p>  Note that if there are no read-write or write-write data races on memory location <em>x</em>, then any read <em>r</em> on <em>x</em> has only one possible <em>W</em>(<em>r</em>): the single <em>w</em> that immediately precedes it in the happens before order.</p>
</blockquote>
<p>ä¸€ä¸ªåœ¨å†…å­˜åœ°å€ä¸º <em>x</em> ä¸Šçš„ è¯»å†™data raceï¼Œä¸»è¦åŒ…æ‹¬ï¼šä¸€ä¸ªåœ¨å†…å­˜ <em>x</em> å¤„çš„è¯»ç‰¹æ€§æ“ä½œ <em>r</em> å’Œä¸€ä¸ªåœ¨åŒä¸€åœ°å€ä¸‹çš„å†™ç‰¹æ€§æ“ä½œ <em>w</em>ï¼Œå¹¶ä¸”ä¸¤è€…è‡³å°‘æœ‰ä¸€ä¸ªæ²¡æœ‰è¿›è¡ŒåŒæ­¥æ“ä½œï¼Œæœ€ç»ˆå°±å¯¼è‡´äº†æ— åºçš„ <em>happens before</em> ï¼ˆå³ï¼šå³ä¸èƒ½ä¿è¯ <em>r</em> åœ¨ <em>w</em> ä¹‹å‰æ‰§è¡Œï¼Œä¹Ÿä¸èƒ½ä¿è¯ <em>w</em> åœ¨ <em>r</em> ä¹‹å‰æ‰§è¡Œï¼‰ï¼›</p>
<p>ä¸€ä¸ªåœ¨å†…å­˜åœ°å€ä¸º <em>x</em> ä¸Šçš„ å†™å†™data raceï¼Œä¸»è¦åŒ…æ‹¬ï¼šä¸¤ä¸ªåœ¨å†…å­˜ <em>x</em> å¤„çš„å†™ç‰¹æ€§æ“ä½œ <em>w</em> å’Œ <em>wâ€˜</em>ï¼Œå¹¶ä¸”ä¸¤è€…è‡³å°‘æœ‰ä¸€ä¸ªæ²¡æœ‰è¿›è¡ŒåŒæ­¥æ“ä½œï¼Œæœ€ç»ˆå°±å¯¼è‡´äº†æ— åºçš„ <em>happens before</em>ï¼›</p>
<p>æ³¨æ„åˆ°ï¼šå¦‚æœåœ¨å†…å­˜ <em>x</em> å¤„æ²¡æœ‰ è¯»å†™æˆ–å†™å†™data raceï¼Œé‚£ä¹ˆæ­¤æ—¶ä»»ä½•è¯»æ“ä½œ <em>r</em> éƒ½åªä¼šæœ‰ä¸€ä¸ªå”¯ä¸€ç¡®å®šçš„ <em>W</em>(<em>r</em>)ï¼šä¸€ä¸ªç´§è·Ÿç€çš„ <em>w</em> æ“ä½œï¼›</p>
<blockquote>
<p>  More generally, it can be shown that any Go program that is data-race-free, meaning it has no program executions with read-write or write-write data races, can only have outcomes explained by some sequentially consistent interleaving of the goroutine executions. (The proof is the same as Section 7 of Boehm and Adveâ€™s paper cited above.) This property is called DRF-SC.</p>
</blockquote>
<p>æ›´ä¸€èˆ¬çš„ç»“è®ºï¼šä»»ä½•ä¸€ä¸ª data-race-free çš„ Go ç¨‹åºéƒ½è¡¨ç¤ºå…¶ä¸å­˜åœ¨ read-write æˆ– write-write data raceï¼Œå¹¶ä¸”éƒ½å¯ä»¥è¢«å”¯ä¸€çš„è¢«è§£é‡Šä¸ºä¸€äº›é¡ºåºä¸€è‡´çš„è¢«äº¤ç»‡åœ¨è®¸å¤š goroutine ä¸­çš„æ‰§è¡Œè¿‡ç¨‹ï¼ˆè¿™ä¸€ç‚¹å’Œå‰é¢æåˆ°çš„ Boehm å’Œ Adve è®ºæ–‡ä¸­çš„ç¬¬ä¸ƒå°èŠ‚ä¸­çš„è¯æ˜å®Œå…¨ä¸€è‡´ï¼ï¼‰ï¼Œè¿™ä¸ªæ€§è´¨å°±è¢«ç§°ä¸º <code>DRF-SC</code>ï¼›</p>
<blockquote>
<p>  The intent of the formal definition is to match the DRF-SC guarantee provided to race-free programs by other languages, including C, C++, Java, JavaScript, Rust, and Swift.</p>
<p>  Certain Go language operations such as goroutine creation and memory allocation act as synchronization operations. The effect of these operations on the synchronized-before partial order is documented in the â€œSynchronizationâ€ section below. Individual packages are responsible for providing similar documentation for their own operations.</p>
</blockquote>
<p>æ›´åŠ å¹¿ä¹‰åŒ–çš„ DRF-SC çš„å®šä¹‰çš„ç›®çš„æ˜¯ä¸ºå…¶ä»–ç¼–ç¨‹è¯­è¨€æä¾›äº† race-free ç¼–ç¨‹çš„å®ç°ï¼ŒåŒ…æ‹¬ï¼šC, C++, Java, JavaScript, Rust, å’Œ Swiftç­‰ï¼›</p>
<p>æŸäº› Go ä¸­çš„æ“ä½œä¾‹å¦‚ï¼šåˆ›å»º goroutineã€å†…å­˜åˆ†é…ç­‰ï¼Œéƒ½è¡¨ç°ä¸ºåŒæ­¥æ“ä½œï¼ˆå†…éƒ¨å®ç°ï¼‰ï¼›</p>
<p>è¿™äº›æ“ä½œå¯¹äºâ€œåœ¨åŒæ­¥æ“ä½œå‰ä¿è¯å±€éƒ¨é¡ºåºâ€ï¼ˆ<code>synchronized-before partial order</code>ï¼‰åœ¨ä¸‹é¢çš„ <code>Synchronization</code> å°èŠ‚ä¼šè¯¦ç»†è®²è¿°ã€‚æ­¤å¤–ï¼Œæ¯ä¸ªç‹¬ç«‹çš„åº“éƒ½æœ‰è´£ä»»ä¸ºè‡ªå·±æä¾›çš„æ“ä½œæä¾›ç›¸åº”çš„ç±»ä¼¼çš„æ–‡æ¡£ã€‚</p>
<br>

<h2 id="å«æœ‰data-raceçš„ä»£ç å®ç°çš„é™åˆ¶"><a href="#å«æœ‰data-raceçš„ä»£ç å®ç°çš„é™åˆ¶" class="headerlink" title="å«æœ‰data-raceçš„ä»£ç å®ç°çš„é™åˆ¶"></a><strong>å«æœ‰data-raceçš„ä»£ç å®ç°çš„é™åˆ¶</strong></h2><blockquote>
<p>  The preceding section gave a formal definition of data-race-free program execution. This section informally describes the semantics that implementations must provide for programs that do contain races.</p>
<p>  First, any implementation can, upon detecting a data race, report the race and halt execution of the program. Implementations using ThreadSanitizer (accessed with â€œ<code>go</code> <code>build</code> <code>-race</code>â€) do exactly this.</p>
<p>  Otherwise, a read <em>r</em> of a memory location <em>x</em> that is not larger than a machine word must observe some write <em>w</em> such that <em>r</em> does not happen before <em>w</em> and there is no write <em>wâ€™</em> such that <em>w</em> happens before <em>wâ€™</em> and <em>wâ€™</em> happens before <em>r</em>. That is, each read must observe a value written by a preceding or concurrent write.</p>
</blockquote>
<p>å‰é¢çš„å†…å®¹ç»™å‡ºäº† data-race-free ç¨‹åºæ‰§è¡Œçš„å®šä¹‰ï¼›æœ¬èŠ‚ä¸»è¦æ˜¯è®²è¿°ä¸ºé‚£äº›å®ç°å¿…é¡»ä¸ºåŒ…å« data-race çš„ç¨‹åºæ‰€å¿…é¡»æä¾›çš„è¯­ä¹‰ï¼›</p>
<p>é¦–å…ˆï¼Œï¼ˆGo æä¾›äº†ç›¸å…³å·¥å…·ä½¿å¾—ï¼‰ä»»ä½•ä»£ç å®ç°éƒ½å¯ä»¥åœ¨æ£€æµ‹åˆ° data race ä¹‹åæŠ¥å‘Š race å†…å®¹ï¼Œå¹¶ä¸”åœæ­¢æ‰§è¡Œç¨‹åºï¼›è¿™ä¸ªç‰¹æ€§ä¸»è¦æ˜¯é€šè¿‡ <code>ThreadSanitizer</code> ï¼ˆå¯ä»¥ä½¿ç”¨ â€œ<code>go</code> <code>build</code> <code>-race</code>â€ï¼‰æ¥å®ç°çš„ï¼›</p>
<p>å¦åˆ™ï¼Œå¯¹äºä¸€ä¸ªåœ¨è¯»å–å†…å­˜åœ°å€ä¸º <em>x</em> ä¸”å¤§å°ä¸è¶…è¿‡ä¸€ä¸ªæœºå™¨å­—é•¿çš„æ“ä½œï¼Œå¿…é¡»èƒ½å¤Ÿè§‚æµ‹åˆ°åœ¨è¿™ä¸ªè¯»æ“ä½œä¹‹å‰çš„ä¸€ä¸ªå†™æ“ä½œ <em>w</em>ï¼ŒåŒæ—¶åœ¨è¿™ä¸ª <em>w</em> å’Œ <em>r</em> ä¹‹é—´ä¸èƒ½æ’å…¥å¦å¤–ä¸€ä¸ªå†™æ“ä½œ <em>wâ€˜</em> ä½¿å¾— <em>w</em> åœ¨ <em>wâ€˜</em> ä¹‹å‰æ‰§è¡Œï¼Œè€Œ <em>wâ€˜</em> åœ¨ <em>r</em> ä¹‹å‰æ‰§è¡Œï¼</p>
<p>å³ï¼šï¼ˆåŒæ­¥æ“ä½œåº”è¯¥ä¿è¯ï¼‰æ¯ä¸ªè¯»å–æ“ä½œéƒ½åº”å½“èƒ½å¤Ÿè§‚æµ‹åˆ°åœ¨ä»–ä¹‹å‰æˆ–è€…å¹¶å‘æ‰§è¡Œçš„å†™æ“ä½œçš„å€¼ï¼</p>
<blockquote>
<p>  è¿™é‡Œè§£é‡Šä¸€ä¸‹ï¼š</p>
<p>  <strong>ä¸ºä»€ä¹ˆè¯»å–æ“ä½œä¼šçœ‹ä¸åˆ°åœ¨ä»–ä¹‹å‰æ‰§è¡Œçš„å†™æ“ä½œçš„å€¼ï¼š</strong></p>
<p>  åœ¨ç°ä»£ CPU æ¶æ„ä¸­ï¼ŒåŸºæœ¬ä¸Šéƒ½ä¼šå­˜åœ¨å¤šçº§çš„ CPU Cache æ¥ç¼“å­˜ï¼Œè¿™æ ·é¿å…äº†æ‰€æœ‰çš„æ“ä½œéƒ½è¦å»è®¿é—®å†…å­˜ç©ºé—´ï¼Œä½†æ˜¯ä¹Ÿå¯¼è‡´äº†ä¸€ä¸ªæ˜¾ç„¶çš„é—®é¢˜ï¼š</p>
<p>  <font color="#f00"><strong>ç”±äºCPUå­˜åœ¨å¤šä¸ªæ ¸ï¼ŒæŸä¸ªæ ¸ä¸­çš„æ•°æ®å¯èƒ½ä¸ä¼šç«‹å³åˆ·å…¥åˆ°å†…å­˜ä¸­ï¼Œè¿™å°±å¯¼è‡´äº†å¦‚æœå…¶ä»–CPUæ ¸å¿ƒå»å†…å­˜ä¸­å–å€¼ï¼Œå–åˆ°çš„æ˜¯æ—§çš„å€¼ï¼Œè€Œé CPU Cache ä¸­çš„å€¼ï¼</strong></font></p>
<p>  <font color="#f00"><strong>Go ä¸­çš„åŒæ­¥åŸè¯­ï¼Œå¦‚ï¼šlockã€channelã€atomic éƒ½ä¿è¯äº† Cache ä¸­çš„å€¼èƒ½å¤Ÿåœ¨å¤šä¸ª goroutine ä¸­å¯è§ï¼ˆåˆ·å…¥å†…å­˜ä¸­ï¼‰ï¼Œè¿™ä¹Ÿæ˜¯ä¸Šé¢çš„å†…å®¹è®²çš„ï¼›</strong></font></p>
<p>  <font color="#f00"><strong>å¯¹äº Javaã€C++ ç­‰è¯­è¨€ï¼Œè¿˜æä¾›äº†ç±»ä¼¼ <code>volatile</code> çš„å…³é”®å­—ï¼Œä¿è¯å˜é‡ç›´æ¥è¢«åˆ·å…¥å†…å­˜ï¼Œä»¥ç¡®ä¿å¯¹å…¶ä»–çº¿ç¨‹çš„å¯ç”¨æ€§ï¼›</strong></font></p>
  <br>

<p>  <strong>å…³äºä¸å¤§äºä¸€ä¸ªå­—é•¿çš„å®šä¹‰ï¼š</strong></p>
<p>  å¯¹äºå¤§äºä¸€ä¸ªå­—é•¿çš„ç»“æ„ï¼Œé€šå¸¸å…¶ç©ºé—´éƒ½æ˜¯åœ¨å †ä¸Šåˆ†é…ï¼Œè€Œåœ¨æ“ä½œæ—¶éƒ½æ˜¯é€šè¿‡ä¸€ä¸ªæœºå™¨å­—é•¿çš„æŒ‡é’ˆè¿›è¡Œæ“ä½œï¼›</p>
<p>  æ‰€ä»¥è¿™é‡Œå…³æ³¨çš„éƒ½æ˜¯ä¸å¤§äºä¸€ä¸ªå­—é•¿çš„å®šä¹‰ï¼Œè€Œé€šå¸¸å¯¹äºè¿™äº›æ•°æ®ï¼Œæ‹·è´ä»–ä»¬çš„å€¼æ¶ˆè€—çš„æ€§èƒ½ï¼Œå’Œç§»åŠ¨ä»–ä»¬çš„å€¼æ¶ˆè€—çš„æ€§èƒ½å‡ ä¹æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œä¾‹å¦‚ï¼šintç±»å‹ï¼›</p>
</blockquote>
<blockquote>
<p>  Additionally, observation of acausal and â€œout of thin airâ€ writes is disallowed.</p>
<p>  Reads of memory locations larger than a single machine word are encouraged but not required to meet the same semantics as word-sized memory locations, observing a single allowed write <em>w</em>. For performance reasons, implementations may instead treat larger operations as a set of individual machine-word-sized operations in an unspecified order. This means that races on multiword data structures can lead to inconsistent values not corresponding to a single write. When the values depend on the consistency of internal (pointer, length) or (pointer, type) pairs, as can be the case for interface values, maps, slices, and strings in most Go implementations, such races can in turn lead to arbitrary memory corruption.</p>
<p>  Examples of incorrect synchronization are given in the â€œIncorrect synchronizationâ€ section below.</p>
<p>  Examples of the limitations on implementations are given in the â€œIncorrect compilationâ€ section below.</p>
</blockquote>
<p>æ­¤å¤–ï¼Œè§‚å¯Ÿåˆ°æœªåˆ†é…ç©ºé—´çš„ï¼ˆ<code>acausal</code>ï¼Œæ— é…å¶çš„ï¼‰å’Œæœªåˆå§‹åŒ–å®Œæˆçš„å¯¹è±¡ï¼ˆ<code>â€œout of thin airâ€</code>ï¼‰çš„å†™å…¥æ˜¯ä¸å…è®¸çš„ï¼›</p>
<p>æˆ‘ä»¬é¼“åŠ±è¯»å–è¶…è¿‡ä¸€ä¸ªæœºå™¨å­—é•¿çš„å†…å­˜ç©ºé—´çš„æ“ä½œï¼Œä½†æ˜¯ä»–çš„è¯­ä¹‰å’Œå•æœºå™¨å­—é•¿çš„åœºæ™¯æœ‰æ‰€ä¸åŒï¼šè§‚å¯Ÿå•ä¸ªå…è®¸å†™å…¥<em>w</em>ï¼›</p>
<p>å‡ºäºæ€§èƒ½æ–¹é¢çš„è€ƒè™‘ï¼Œåœ¨çœŸæ­£å®ç°æ—¶ï¼Œè¶…è¿‡ä¸€ä¸ªæœºå™¨å­—é•¿çš„å†…å­˜ç©ºé—´çš„æ“ä½œå¯èƒ½è¢«å¤„ç†ä¸ºå¤šä¸ªç‹¬ç«‹çš„å•æœºå™¨å­—é•¿çš„æ— åºæ“ä½œã€‚è¿™è¡¨ç¤ºå¤šå­—é•¿çš„æ•°æ®ä¸Šçš„ data race å¯èƒ½ä¼šå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´æ€§ï¼Œè¿™å’Œï¼ˆä¹‹å‰ï¼‰å•ä¸ªçš„å†™å…¥æ“ä½œï¼ˆçš„è¡¨ç°ï¼‰ä¸åŒï¼›</p>
<p>å½“æŸä¸ªå¤æ‚ç±»å‹çš„å–å€¼ä¾é ï¼šå†…éƒ¨å®ç°ï¼ˆæŒ‡é’ˆï¼Œé•¿åº¦ï¼‰æˆ–è€…æ•°æ®å¯¹ï¼ˆæŒ‡é’ˆï¼Œç±»å‹ï¼‰æ—¶ï¼Œä¾‹å¦‚ï¼šmapã€sliceã€string åœ¨ Go ä¸­çš„å®ç°ï¼Œè¿™æ ·çš„æ•°æ®ç«äº‰ä¼šå¯¼è‡´å†…å­˜ä¸­çš„æ•°æ®æŸåï¼ˆmemory corruptionï¼‰ï¼Œå‡ºç°ä¸ä¸€è‡´ï¼›</p>
<p>ä¸‹é¢çš„â€œä¸æ­£ç¡®åŒæ­¥â€ï¼ˆ<code>â€œIncorrect synchronizationâ€</code>ï¼‰å°èŠ‚ç»™å‡ºäº†é”™è¯¯åŒæ­¥çš„ä»£ç ä¾‹å­ï¼›</p>
<p>ä¸‹é¢çš„â€œé”™è¯¯ç¼–è¯‘â€ï¼ˆ<code>â€œIncorrect compilationâ€</code>ï¼‰å°èŠ‚ç»™å‡ºäº†data race å®ç°é™åˆ¶çš„ä»£ç ä¾‹å­ï¼›</p>
<br>

<h2 id="åŒæ­¥ï¼ˆSynchronizationï¼‰"><a href="#åŒæ­¥ï¼ˆSynchronizationï¼‰" class="headerlink" title="åŒæ­¥ï¼ˆSynchronizationï¼‰"></a><strong>åŒæ­¥ï¼ˆSynchronizationï¼‰</strong></h2><h3 id="åˆå§‹åŒ–ï¼ˆInitializationï¼‰"><a href="#åˆå§‹åŒ–ï¼ˆInitializationï¼‰" class="headerlink" title="åˆå§‹åŒ–ï¼ˆInitializationï¼‰"></a><strong>åˆå§‹åŒ–ï¼ˆInitializationï¼‰</strong></h3><blockquote>
<p>  Program initialization runs in a single goroutine, but that goroutine may create other goroutines, which run concurrently.</p>
<p>  If a package <code>p</code> imports package <code>q</code>, the completion of <code>q</code>â€˜s <code>init</code> functions happens before the start of any of <code>p</code>â€˜s.</p>
<p>  The completion of all <code>init</code> functions is synchronized before the start of the function <code>main.main</code>.</p>
</blockquote>
<p>Go ç¨‹åºçš„åˆå§‹åŒ–éƒ½æ˜¯è¿è¡Œåœ¨å•ä¸€çš„ä¸€ä¸ª goroutine ä¸­çš„ï¼Œä½†æ˜¯è¿™ä¸ª goroutine å¯ä»¥åˆ›å»ºå¤§é‡å…¶ä»–çš„ goroutineï¼Œå¹¶ä¸”è¿™äº› goroutine æ˜¯å¹¶è¡Œè¿è¡Œçš„ï¼</p>
<blockquote>
<p>  <strong>å³ï¼Œå¼€å§‹çš„æ—¶å€™ï¼Œmain å‡½æ•°åˆ›å»ºç¬¬ä¸€ä¸ª goroutineï¼Œç„¶åè¿™ä¸ª goroutine åˆ›é€ äº†ä¸‡ç‰©ï¼</strong></p>
</blockquote>
<p>å¦‚æœåŒ… <code>p</code> import äº†åŒ… <code>q</code>ï¼Œé‚£ä¹ˆåŒ… <code>q</code> ä¸­çš„ <code>init</code> å‡½æ•°çš„æ‰§è¡Œè¦ä¸¥æ ¼ä¼˜å…ˆäºåŒ… <code>p</code>ï¼</p>
<p>åœ¨ <code>main</code> å‡½æ•°å¼€å§‹ä¹‹å‰ï¼Œæ‰€æœ‰çš„ <code>init</code> å‡½æ•°éƒ½æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼›</p>
<p>ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p>
<p>initialization</p>
<pre><code class="go">// p/p.go
package p

import &quot;fmt&quot;

func init() {
    func() {
        fmt.Println(&quot;p init in a new goroutine&quot;)
    }()
}

func P() {
    fmt.Println(&quot;this is p&quot;)
}

// q/q.go
package q

import (
    &quot;fmt&quot;
    &quot;initialization/p&quot;
)

func init() {
    func() {
        fmt.Println(&quot;q init in a new goroutine&quot;)
    }()
}

func RunP() {
    p.P()
}

// main.go
package main

import (
    _ &quot;initialization/q&quot;

    _ &quot;initialization/p&quot;
)

// Will print:
//  p init in a new goroutine
//  q init in a new goroutine
// Even though the q is imported first!
func main() {
}</code></pre>
<p>ç”±äºåŒ… <code>q</code> import äº† åŒ… <code>p</code>ï¼Œå› æ­¤ï¼Œåœ¨ main ä¸­ï¼Œå³ä½¿åŒ… <code>q</code> é¦–å…ˆè¢«å¼•å…¥ï¼Œä½†æ˜¯ç”±äºä¸Šé¢çš„é™åˆ¶ï¼Œä¼šé¦–å…ˆæ‰§è¡ŒåŒ… <code>p</code> ä¸­çš„ <code>init</code>ï¼Œç„¶åå†æ‰§è¡ŒåŒ… <code>q</code> ä¸­çš„ <code>init</code> å‡½æ•°ï¼å› æ­¤è¾“å‡ºï¼š</p>
<pre><code>p init in a new goroutine
q init in a new goroutine</code></pre><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬å°† <code>q.go</code> ä¸­çš„ <code>p.P()</code> æ³¨é‡Šæ‰ï¼Œå³ï¼šä¸å† import åŒ… <code>p</code>ï¼Œåˆ™æ­¤æ—¶æ ¹æ® main ä¸­ import çš„ä¼˜å…ˆçº§ï¼Œä¼šè¾“å‡ºï¼š</p>
<pre><code>q init in a new goroutine
p init in a new goroutine</code></pre><br>

<h3 id="åˆ›å»ºGoroutineï¼ˆGoroutine-creationï¼‰"><a href="#åˆ›å»ºGoroutineï¼ˆGoroutine-creationï¼‰" class="headerlink" title="åˆ›å»ºGoroutineï¼ˆGoroutine creationï¼‰"></a><strong>åˆ›å»ºGoroutineï¼ˆGoroutine creationï¼‰</strong></h3><blockquote>
<p>  The <code>go</code> statement that starts a new goroutine is synchronized before the start of the goroutineâ€™s execution.</p>
<p>  For example, in this program:</p>
<p>  calling <code>hello</code> will print <code>&quot;hello, world&quot;</code> at some point in the future (perhaps after <code>hello</code> has returned).</p>
</blockquote>
<p><code>go</code> å…³é”®å­—ä¼šå¼€å¯ä¸€ä¸ªæ–°çš„ goroutineï¼Œå¹¶ä¸”åœ¨è¿™ä¸ª goroutine å¼€å§‹æ‰§è¡Œä¹‹å‰ï¼Œè¿™ä¸ª goroutine æ˜¯åŒæ­¥è¢«åˆ›å»ºçš„ï¼</p>
<p>ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p>
<p>goroutine-creation/main.go</p>
<pre><code class="go">var a string

func f() {
    fmt.Println(a)
}

func hello() {
    a = &quot;hello, world&quot;
    go f()
}

func main() {

    hello()

    fmt.Println(&quot;hello returned&quot;)

    &lt;-time.After(1 * time.Second)
}</code></pre>
<p>è°ƒç”¨ hello åœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´æ€»æ˜¯ä¼šä¿è¯è¾“å‡º <code>&quot;hello, world&quot;</code>ï¼ˆå¹¶ä¸”æœ‰å¯èƒ½æ˜¯å‡½æ•° hello è¿”å›ä¹‹åè¾“å‡ºï¼‰ï¼›</p>
<blockquote>
<p>  <strong>è¿™é‡Œè§£é‡Šä¸€ä¸‹ï¼š</strong></p>
<p>  <strong>å¯¹åº”äºä¸Šé¢è®²è¿°çš„ goroutine çš„åˆ›å»ºæ˜¯ä¸€ä¸ªåŒæ­¥çš„è¿‡ç¨‹ï¼Œå› æ­¤ä¿è¯äº†åœ¨æ‰§è¡Œ <code>go f()</code> ä¹‹å‰ï¼Œ<code>a = &quot;hello, world&quot;</code> ä¸€å®šä¼šè¢«æ‰§è¡Œï¼Œå› æ­¤å˜é‡ a ä¸€å®šä¼šè¢«æ­£å¸¸çš„åˆå§‹åŒ–ï¼Œæ‰€ä»¥å¯ä»¥è¾“å‡º <code>&quot;hello, world&quot;</code>ï¼</strong></p>
</blockquote>
<p>å› æ­¤ï¼Œä¸Šé¢çš„ä»£ç æœ€ç»ˆå¯èƒ½ä¼šè¾“å‡ºï¼š</p>
<pre><code>hello returned
hello, world</code></pre><br>

<h3 id="é”€æ¯Goroutineï¼ˆGoroutine-destructionï¼‰"><a href="#é”€æ¯Goroutineï¼ˆGoroutine-destructionï¼‰" class="headerlink" title="é”€æ¯Goroutineï¼ˆGoroutine destructionï¼‰"></a><strong>é”€æ¯Goroutineï¼ˆGoroutine destructionï¼‰</strong></h3><blockquote>
<p>  The exit of a goroutine is not guaranteed to be synchronized before any event in the program. For example, in this program:</p>
<p>  the assignment to <code>a</code> is not followed by any synchronization event, so it is not guaranteed to be observed by any other goroutine. In fact, an aggressive compiler might delete the entire <code>go</code> statement.</p>
<p>  If the effects of a goroutine must be observed by another goroutine, use a synchronization mechanism such as a lock or channel communication to establish a relative ordering.</p>
</blockquote>
<p>Goroutine çš„é€€å‡ºä¸èƒ½ä¿è¯æ“ä½œçš„åŒæ­¥ï¼Œä¾‹å¦‚ï¼š</p>
<p>goroutine-destruction/main.go</p>
<pre><code class="go">var a string

func hello() {
    go func() { a = &quot;hello&quot; }()
    fmt.Println(a)
}

func main() {

    hello()

    fmt.Println(&quot;hello returned&quot;)

    &lt;-time.After(1 * time.Second)
}</code></pre>
<p>ç”±äºç»™å˜é‡ <code>a</code> èµ‹å€¼æ—¶æ²¡æœ‰ä½¿ç”¨ä»»ä½•çš„åŒæ­¥æ“ä½œï¼Œå› æ­¤ä¸èƒ½å¤Ÿä¿è¯å¯¹å˜é‡ <code>a</code> çš„èµ‹å€¼èƒ½å¤Ÿç›´æ¥è¢«å…¶ä»–çš„ goroutine è§‚æµ‹åˆ°ã€‚äº‹å®ä¸Šï¼Œä¸€äº›ä¼˜åŒ–æ¯”è¾ƒæ¿€è¿›çš„ç¼–è¯‘å™¨ä¼šç›´æ¥æŠŠä¸Šé¢çš„æ•´ä¸ª <code>go</code> è¯­å¥åˆ é™¤ï¼›</p>
<p>å¦‚æœ goroutine å¯¹ç¨‹åºäº§ç”Ÿçš„å½±å“å¿…é¡»è¢«å…¶ä»– goroutine è§‚æµ‹åˆ°ï¼Œé‚£ä¹ˆå¿…é¡»è¦ä½¿ç”¨ä¸€äº›åŒæ­¥çš„æœºåˆ¶ï¼Œæ¯”å¦‚ï¼šé”æˆ–è€… Channel æ¥å»ºç«‹å¼ºä¸€è‡´çš„å…³è”é¡ºåºï¼›</p>
<br>

<h3 id="Channelé€šä¿¡ï¼ˆChannel-communicationï¼‰"><a href="#Channelé€šä¿¡ï¼ˆChannel-communicationï¼‰" class="headerlink" title="Channelé€šä¿¡ï¼ˆChannel communicationï¼‰"></a><strong>Channelé€šä¿¡ï¼ˆChannel communicationï¼‰</strong></h3><h4 id="æ— ç¼“å­˜Channel"><a href="#æ— ç¼“å­˜Channel" class="headerlink" title="æ— ç¼“å­˜Channel"></a><strong>æ— ç¼“å­˜Channel</strong></h4><blockquote>
<p>  Channel communication is the main method of synchronization between goroutines. Each send on a particular channel is matched to a corresponding receive from that channel, usually in a different goroutine.</p>
<p>  A send on a channel is synchronized before the completion of the corresponding receive from that channel.</p>
<p>  This program:</p>
<p>  is guaranteed to print <code>&quot;hello, world&quot;</code>. The write to <code>a</code> is sequenced before the send on <code>c</code>, which is synchronized before the corresponding receive on <code>c</code> completes, which is sequenced before the <code>print</code>.</p>
<p>  The closing of a channel is synchronized before a receive that returns a zero value because the channel is closed.</p>
<p>  In the previous example, replacing <code>c &lt;- 0</code> with <code>close(c)</code> yields a program with the same guaranteed behavior.</p>
</blockquote>
<p>Channel æ˜¯ä¸€ä¸ªåœ¨ goroutine ä¹‹é—´è¿›è¡ŒåŒæ­¥çš„ä¸»è¦æ‰‹æ®µï¼›æ¯ä¸ªå‘ channel å‘é€çš„æ¶ˆæ¯ï¼Œéƒ½å­˜åœ¨ä¸€ä¸ªå¯¹åº”çš„æ¥æ”¶è€…ï¼Œå¹¶ä¸”é€šå¸¸è¿™ä¸ªæ¥æ”¶è€…åœ¨å¦ä¸€ä¸ª goroutine ä¸­ï¼›</p>
<p>åœ¨ Channel ä¸Šçš„å‘é€æ“ä½œä¼šåœ¨è¢«å¯¹åº”çš„æ¥æ”¶è€…æ¥æ”¶ä¹‹å‰è€Œè¢«åŒæ­¥ï¼›</p>
<p>ä»¥ä¸‹é¢çš„ä»£ç ä¸ºä¾‹ï¼š</p>
<p>channel-communication/demo_1_test.go</p>
<pre><code class="go">var c = make(chan int, 10)
var a string

func f() {
    a = &quot;hello, world&quot;
    c &lt;- 0
    //close(c)
}

func TestDemo1(t *testing.T) {
    go f()
    &lt;-c
    print(a)
}</code></pre>
<p>ä¸Šé¢çš„ä»£ç ä¿è¯ä¼šæ‰“å°å‡º <code>&quot;hello, world&quot;</code>ï¼›å› ä¸ºå¯¹äº <code>a</code> çš„å†™å…¥æ“ä½œä¼šè¢«ä¸‹ä¸€è¡Œ <code>c &lt;- 0</code> çš„å‘é€åŒæ­¥ï¼Œåªæœ‰åœ¨ channel <code>c</code> ä¸­çš„æ•°æ®è¢«æ¥æ”¶åï¼Œæ‰ä¼šæ‰§è¡Œ <code>print</code>ï¼›</p>
<p>channel çš„å…³é—­ä¼šåœ¨æ¥æ”¶æ“ä½œä¹‹å‰åŒæ­¥çš„æ‰§è¡Œï¼Œæ­¤åç”±äº channel å·²ç»å…³é—­ï¼Œæ¥æ”¶è€…ä¼šæ¥æ”¶åˆ°é›¶å€¼ï¼</p>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå°† <code>c &lt;- 0</code> æ›¿æ¢ä¸º  <code>close(c)</code>ï¼Œä¹Ÿèƒ½å¾—åˆ°ç›¸åŒçš„ç»“æœï¼›</p>
<br>

<blockquote>
<p>  A receive from an unbuffered channel is synchronized before the completion of the corresponding send on that channel.</p>
<p>  This program (as above, but with the send and receive statements swapped and using an unbuffered channel):</p>
<p>  is also guaranteed to print <code>&quot;hello, world&quot;</code>. The write to <code>a</code> is sequenced before the receive on <code>c</code>, which is synchronized before the corresponding send on <code>c</code> completes, which is sequenced before the <code>print</code>.</p>
<p>  If the channel were buffered (e.g., <code>c = make(chan int, 1)</code>) then the program would not be guaranteed to print <code>&quot;hello, world&quot;</code>. (It might print the empty string, crash, or do something else.)</p>
</blockquote>
<p>ï¼ˆå‰é¢çœ‹åˆ°äº†ï¼‰ä»ä¸€ä¸ªæ— ç¼“å­˜çš„ Channel ä¸­è¯»å–æ¶ˆæ¯æ—¶ï¼ˆè¯¥ goroutineï¼‰ä¼šè¢«å¼ºåˆ¶åŒæ­¥ï¼Œç›´åˆ°å­˜åœ¨æ¶ˆæ¯å‘é€åˆ°äº†å¯¹åº”çš„ Channel ä¸­ï¼›</p>
<p>ä¸‹é¢çš„ä»£ç å’Œä¸Šé¢çš„ä¾‹å­ç±»ä¼¼ï¼Œä¸è¿‡å°†å‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„ä½ç½®äº¤æ¢äº†ï¼›</p>
<p>channel-communication/demo_2_test.go</p>
<pre><code class="go">var c2 = make(chan int, 10)
var a2 string

func f2() {
    a2 = &quot;hello, world&quot;
    &lt;-c2
}

func TestDemo2(t *testing.T) {
    go f2()
    c2 &lt;- 0
    print(a2)
}</code></pre>
<p>å’Œå‰é¢çš„ä¾‹å­ç±»ä¼¼ï¼Œè¿™é‡Œçš„ä»£ç ä¹Ÿèƒ½å¤Ÿä¿è¯æ‰“å°å‡º <code>&quot;hello, world&quot;</code>ï¼›å¯¹å˜é‡ <code>a2</code> çš„å†™å…¥ä¼šè¢« <code>&lt;-c2</code> é˜»å¡ç­‰å¾…è€ŒåŒæ­¥ï¼›</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœè¿™æ˜¯ä¸€ä¸ªæœ‰ç¼“å­˜çš„ Channelï¼ˆ<code>c = make(chan int, 1)</code>ï¼‰ï¼Œåˆ™å°±æ— æ³•ä¿è¯è¾“å‡º <code>&quot;hello, world&quot;</code> äº†ï¼ˆå¯èƒ½ä¼šå‘ç”Ÿï¼šè¾“å‡ºç©ºå­—ç¬¦ä¸²ã€ç¨‹åºå´©æºƒç­‰ç­‰ï¼‰ï¼›</p>
<br>

<h4 id="æœ‰ç¼“å­˜Channel"><a href="#æœ‰ç¼“å­˜Channel" class="headerlink" title="æœ‰ç¼“å­˜Channel"></a><strong>æœ‰ç¼“å­˜Channel</strong></h4><blockquote>
<p>  The <em>k</em>th receive on a channel with capacity <em>C</em> is synchronized before the completion of the <em>k</em>+<em>C</em>th send from that channel completes.</p>
<p>  This rule generalizes the previous rule to buffered channels. It allows a counting semaphore to be modeled by a buffered channel: the number of items in the channel corresponds to the number of active uses, the capacity of the channel corresponds to the maximum number of simultaneous uses, sending an item acquires the semaphore, and receiving an item releases the semaphore. This is a common idiom for limiting concurrency.</p>
<p>  This program starts a goroutine for every entry in the work list, but the goroutines coordinate using the <code>limit</code> channel to ensure that at most three are running work functions at a time.</p>
</blockquote>
<p>ç¬¬ k ä¸ªåœ¨ç¼“å­˜ä¸º C çš„ Channel ä¸Šè¢«åŒæ­¥ï¼Œç›´åˆ°ç¬¬ k+C ä¸ªå‘ç”Ÿåˆ°è¿™ä¸ª channel çš„æ¶ˆæ¯è¢«æˆåŠŸå‘é€ï¼›</p>
<p>è¿™ä¸ªè§„åˆ™æ˜¯ä¸€ä¸ªæ¨å¹¿åçš„ç»“è®ºï¼›å®ƒå…è®¸äº†æœ‰é™ä¸ªæ•°çš„ä¿¡å·é‡ï¼ˆ<code>semaphore</code>ï¼‰è¢«æŠ½è±¡ä¸ºäº†ä¸€ä¸ªæœ‰ç¼“å­˜çš„ Channelï¼šChannel ä¸­çš„æ¶ˆæ¯æ•°é‡å¯¹äºç›®å‰æ­£åœ¨æ´»è·ƒçš„ä½¿ç”¨æ•°ï¼ˆçº¿ç¨‹æ•°ï¼‰ï¼ŒChannel çš„ç¼“å­˜å¤§å°å¯¹åº”äºå¯ä»¥åŒæ—¶å¹¶å‘çš„æ•°é‡ï¼›å½“å‘é€æ¶ˆæ¯æ—¶è·å–ä¿¡å·é‡ï¼Œå½“æ¥æ”¶æ¶ˆæ¯åé‡Šæ”¾ä¿¡å·é‡ï¼›è¿™ä¹Ÿæ˜¯é™åˆ¶å¹¶å‘çš„é€šå¸¸ç”¨æ³•ï¼›</p>
<p>ä¸‹é¢çš„ç¨‹åºä¸ºä»»åŠ¡åˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ªæ¡ç›®éƒ½å¼€å¯äº†ä¸€ä¸ª goroutineï¼Œä½†æ˜¯ç”±äºæœ‰ç¼“å­˜ Channel çš„é™åˆ¶ï¼Œä¿è¯äº†ä¸€æ¬¡æœ€å¤šæœ‰ 3 ä¸ª goroutine åœ¨åŒæ—¶æ‰§è¡Œï¼›</p>
<p>channel-communication/demo_3_test.go</p>
<pre><code class="go">var limit = make(chan int, 3)

func TestDemo3(t *testing.T) {

    work := make([]func(), 0)
    for i := 0; i &lt; 10; i++ {
        aI := i
        work = append(work, func() {
            fmt.Printf(&quot;Hello, this is: %d\n&quot;, aI)
        })
    }

    for _, w := range work {
        go func(w func()) {
            limit &lt;- 1
            w()
            time.Sleep(time.Second * 1)
            &lt;-limit
        }(w)
    }

    &lt;-time.After(time.Second * 10)
}</code></pre>
<p>ä¸Šé¢çš„ä»£ç ä¼šæ¯æ¬¡è¾“å‡º3ä¸ªä»»åŠ¡ï¼Œç›´åˆ°æœ€åç»“æŸï¼›</p>
<br>

<h3 id="Locks"><a href="#Locks" class="headerlink" title="Locks"></a><strong>Locks</strong></h3><blockquote>
<p>  The <code>sync</code> package implements two lock data types, <code>sync.Mutex</code> and <code>sync.RWMutex</code>.</p>
<p>  For any <code>sync.Mutex</code> or <code>sync.RWMutex</code> variable <code>l</code> and <em>n</em> &lt; <em>m</em>, call <em>n</em> of <code>l.Unlock()</code> is synchronized before call <em>m</em> of <code>l.Lock()</code> returns.</p>
<p>  This program:</p>
<p>  is guaranteed to print <code>&quot;hello, world&quot;</code>. The first call to <code>l.Unlock()</code> (in <code>f</code>) is synchronized before the second call to <code>l.Lock()</code> (in <code>main</code>) returns, which is sequenced before the <code>print</code>.</p>
</blockquote>
<p><code>sync</code> åŒ…æä¾›äº†ä¸¤ç§é”ç±»å‹ï¼š<code>sync.Mutex</code> å’Œ <code>sync.RWMutex</code>ï¼›</p>
<p>å¯¹äº <code>sync.Mutex</code> æˆ– <code>sync.RWMutex</code> ç±»å‹çš„å˜é‡ <code>l</code>ï¼Œå¹¶ä¸” <em>n</em> &lt; <em>m</em>ï¼Œn æ¬¡è°ƒç”¨ <code>l.Unlock()</code> ä¼šåœ¨ m æ¬¡è°ƒç”¨ <code>l.Lock()</code> è¿”å›ä¹‹å‰è¢«åŒæ­¥ï¼›</p>
<p>æ¥çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<p>locks/demo1_test.go</p>
<pre><code class="go">var l sync.Mutex
var a string

func f() {
    a = &quot;hello, world&quot;
    l.Unlock()
}

func TestDemo1(t *testing.T) {
    l.Lock()
    go f()
    l.Lock()
    print(a)
}</code></pre>
<p>ä»£ç ä¿è¯èƒ½å¤Ÿæ‰“å°å‡ºï¼š<code>&quot;hello, world&quot;</code>ï¼Œé¦–æ¬¡åœ¨ <code>f()</code> ä¸­è°ƒç”¨ <code>l.Unlock()</code> è¢«ç¬¬äºŒæ¬¡åœ¨ main å‡½æ•°ä¸­è°ƒç”¨çš„ <code>l.Lock()</code> æ‰€åŒæ­¥ï¼Œå› æ­¤ä¿è¯äº†ï¼ˆå˜é‡çš„èµ‹å€¼ï¼‰é¡ºåºä¸€å®šåœ¨ <code>print</code> ä¹‹å‰ï¼›</p>
<blockquote>
<p>  For any call to <code>l.RLock</code> on a <code>sync.RWMutex</code> variable <code>l</code>, there is an <em>n</em> such that the <em>n</em>th call to <code>l.Unlock</code> is synchronized before the return from <code>l.RLock</code>, and the matching call to <code>l.RUnlock</code> is synchronized before the return from call <em>n</em>+1 to <code>l.Lock</code>.</p>
<p>  A successful call to <code>l.TryLock</code> (or <code>l.TryRLock</code>) is equivalent to a call to <code>l.Lock</code> (or <code>l.RLock</code>). An unsuccessful call has no synchronizing effect at all. As far as the memory model is concerned, <code>l.TryLock</code> (or <code>l.TryRLock</code>) may be considered to be able to return false even when the mutex <em>l</em> is unlocked.</p>
</blockquote>
<p>å¯¹äºä»»æ„è°ƒç”¨ <code>l.RLock</code> çš„ <code>sync.RWMutex</code> ç±»å‹çš„å˜é‡ <code>l</code>ï¼Œå­˜åœ¨ä¸€ä¸ª <em>n</em>ï¼Œä½¿å¾—ç¬¬ n æ¬¡è°ƒç”¨ <code>l.Unlock</code> åœ¨ <code>l.RLock</code> è¿”å›ä¹‹å‰è¢«åŒæ­¥ï¼Œå¹¶ä¸” <code>l.RUnlock</code> åœ¨ <code>l.Lock</code> è¢« n+1 æ¬¡è°ƒç”¨è¿”å›ä¹‹å‰è¢«åŒæ­¥ï¼›</p>
<p>ä¸€ä¸ªæˆåŠŸçš„è°ƒç”¨ <code>l.TryLock</code> (æˆ–è€… <code>l.TryRLock</code>) å’Œè°ƒç”¨ <code>l.Lock</code> (æˆ–è€… <code>l.RLock</code>) çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼›ä½†æ˜¯ï¼Œä¸€ä¸ªä¸æˆåŠŸçš„è°ƒç”¨ï¼Œä¸ä¼šäº§ç”Ÿä»»ä½•åŒæ­¥çš„æ•ˆæœï¼›</p>
<p>å°±å†…å­˜æ¨¡å‹ï¼ˆçš„å®šä¹‰ï¼‰æ¥è¯´ï¼Œå³ä½¿ Mutex å·²ç»è¢«è§£é”äº†ï¼Œ<code>l.TryLock</code> (æˆ–è€… <code>l.TryRLock</code>) ä¹Ÿæœ‰å¯èƒ½è¿”å› falseï¼ˆå³è·å–é”å¤±è´¥ï¼ï¼‰ï¼›</p>
<br>

<h3 id="Once"><a href="#Once" class="headerlink" title="Once"></a><strong>Once</strong></h3><blockquote>
<p>  The <code>sync</code> package provides a safe mechanism for initialization in the presence of multiple goroutines through the use of the <code>Once</code> type. Multiple threads can execute <code>once.Do(f)</code> for a particular <code>f</code>, but only one will run <code>f()</code>, and the other calls block until <code>f()</code> has returned.</p>
<p>  The completion of a single call of <code>f()</code> from <code>once.Do(f)</code> is synchronized before the return of any call of <code>once.Do(f)</code>.</p>
<p>  In this program:</p>
<p>  calling <code>twoprint</code> will call <code>setup</code> exactly once. The <code>setup</code> function will complete before either call of <code>print</code>. The result will be that <code>&quot;hello, world&quot;</code> will be printed twice.</p>
</blockquote>
<p><code>sync</code> åŒ…æä¾›äº†ä¸€ç§å®‰å…¨çš„æœºåˆ¶ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ <code>Once</code> ç±»å‹åœ¨å¤šä¸ª goroutines å¹¶å‘æ‰§è¡Œçš„çš„æƒ…å†µä¸‹è¿›è¡Œåˆå§‹åŒ–ï¼›</p>
<p><strong>å¤šä¸ªçº¿ç¨‹å¯ä»¥å¯¹å‡½æ•° <code>f</code> æ‰§è¡Œ <code>once.Do(f)</code>ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿæ‰§è¡Œ <code>f()</code>ï¼Œè€Œå…¶ä»–çº¿ç¨‹åœ¨è°ƒç”¨æ—¶ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°ï¼ˆä¸Šä¸€ä¸ªè°ƒç”¨ï¼‰ <code>f()</code> ï¼ˆçš„çº¿ç¨‹ï¼‰è¿”å›ï¼›</strong></p>
<p>æ¥çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<p>once/main.go</p>
<pre><code class="go">var a string
var once sync.Once

func setup() {
    a = &quot;hello, world&quot;
    fmt.Println(&quot;a has been setup&quot;)
}

func doPrint() {
    once.Do(setup)
    fmt.Println(a)
}

func twoPrint() {
    go doPrint()
    go doPrint()
}

func main() {

    twoPrint()

    &lt;-time.After(1 * time.Second)
}</code></pre>
<p>è°ƒç”¨ <code>twoPrint</code> åä¼šä¸”ä»…ä¼šè°ƒç”¨ <code>setup</code> å‡½æ•°ä¸€æ¬¡ï¼›æ­¤åä»»æ„ä¸€ä¸ª <code>doPrint</code> çš„è°ƒç”¨ï¼Œ<code>setup</code> å‡½æ•° éƒ½ä¼šç«‹å³å®Œæˆï¼</p>
<p>å› æ­¤ï¼Œä¸Šé¢çš„ä»£ç ä¼šæ‰“å° <code>&quot;a has been setup&quot;</code> ä¸€æ¬¡ï¼Œ<code>&quot;hello, world&quot;</code> ä¸¤æ¬¡ï¼š</p>
<pre><code>a has been setup
hello, world
hello, world</code></pre><br>

<h3 id="Atomic-Values"><a href="#Atomic-Values" class="headerlink" title="Atomic Values"></a><strong>Atomic Values</strong></h3><blockquote>
<p>  The APIs in the <a href="https://go.dev/pkg/sync/atomic/" target="_blank" rel="noopener"><code>sync/atomic</code></a> package are collectively â€œatomic operationsâ€ that can be used to synchronize the execution of different goroutines. If the effect of an atomic operation <em>A</em> is observed by atomic operation <em>B</em>, then <em>A</em> is synchronized before <em>B</em>. All the atomic operations executed in a program behave as though executed in some sequentially consistent order.</p>
<p>  The preceding definition has the same semantics as C++â€™s sequentially consistent atomics and Javaâ€™s <code>volatile</code> variables.</p>
</blockquote>
<p>åœ¨ <a href="https://go.dev/pkg/sync/atomic/" target="_blank" rel="noopener"><code>sync/atomic</code></a> åŒ…ä¸­çš„ API æä¾›äº† <code>åŸå­æ“ä½œ</code> çš„é›†åˆï¼Œå¯ä»¥ç”¨äºåœ¨å¤šä¸ª goroutine ä¹‹é—´åŒæ­¥æ‰§è¡Œï¼ˆå˜é‡çš„å¯è§‚æµ‹æ€§ï¼‰ï¼›å¦‚æœä¸€ä¸ªåŸå­æ€§æ“ä½œ <code>A</code> èƒ½å¤Ÿè¢«å¦ä¸€ä¸ªåŸå­æ€§æ“ä½œ <code>B</code> è§‚æµ‹åˆ°ï¼Œåˆ™è¯´æ˜æ“ä½œAåœ¨æ“ä½œBä¹‹å‰è¿›è¡Œäº†åŒæ­¥ï¼›ä¸€ä¸ªç¨‹åºä¸­æ‰§è¡Œçš„æ‰€æœ‰åŸå­æ“ä½œï¼Œéƒ½ä¼šä»¥æŸç§é¡ºåºä¸€è‡´çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼›</p>
<p>ä¸Šé¢çš„å®šä¹‰å’Œ C++ ä¸­é¡ºåºä¸€è‡´åŸå­å®šä¹‰ä»¥åŠ Java ä¸­ <code>volatile</code> ç±»å‹çš„å˜é‡çš„è¯­ä¹‰æ˜¯ä¸€è‡´çš„ï¼</p>
<p>æ¥çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<p>atomic/main.go</p>
<pre><code class="go">func main() {

    var ops uint64 = 0

    for i := 0; i &lt; 50; i++ {
        go func() {
            atomic.AddUint64(&amp;ops, 1)
        }()
    }

    time.Sleep(time.Second)

    opsFinal := atomic.LoadUint64(&amp;ops)
    fmt.Println(&quot;ops:&quot;, opsFinal)
}</code></pre>
<p>atomic åŸå­æ“ä½œä¸»è¦ç”¨äºå¹¶å‘ç¯å¢ƒä¸‹ï¼Œæ— é¡»åŠ é”å¯¹æ•´æ•°è¿›è¡Œå®‰å…¨çš„åŠ å‡ã€æ¯”è¾ƒã€è¯»å–æ“ä½œï¼›</p>
<p>å› æ­¤ä¸Šé¢çš„ä»£ç èƒ½å¤Ÿå‡†ç¡®æ— è¯¯çš„è¾“å‡ºï¼š</p>
<pre><code>ops: 50</code></pre><br>

<h3 id="Finalizers"><a href="#Finalizers" class="headerlink" title="Finalizers"></a><strong>Finalizers</strong></h3><blockquote>
<p>  The <a href="https://go.dev/pkg/runtime/" target="_blank" rel="noopener"><code>runtime</code></a> package provides a <code>SetFinalizer</code> function that adds a finalizer to be called when a particular object is no longer reachable by the program. A call to <code>SetFinalizer(x, f)</code> is synchronized before the finalization call <code>f(x)</code>.</p>
</blockquote>
<p><a href="https://go.dev/pkg/runtime/" target="_blank" rel="noopener"><code>runtime</code></a> æä¾›äº† <code>SetFinalizer</code> å‡½æ•°æ¥ä¸ºæŸä¸ªç‰¹å®šçš„å¯¹è±¡å®šä¹‰ç»ˆç»“å™¨ï¼ˆ<code>finalizer</code>ï¼‰ï¼Œå½“è¿™ä¸ªå¯¹è±¡åœ¨ç¨‹åºä¸­ä¸å¯è¾¾ä¹‹åè°ƒç”¨ï¼›</p>
<p>åŒæ—¶è°ƒç”¨ <code>SetFinalizer(x, f)</code> ä¸€å®šåœ¨è°ƒç”¨ <code>f(x)</code> ä¹‹å‰è¢«åŒæ­¥ï¼›</p>
<p>æ¥çœ‹ä¾‹å­ï¼š</p>
<p>finalizer/main.go</p>
<pre><code class="go">type Foo struct {
    a int
}

func main() {
    for i := 0; i &lt; 3; i++ {
        f := NewFoo(i)
        println(f.a)
    }

    runtime.GC()

    time.Sleep(time.Second)
}

//go:noinline
func NewFoo(i int) *Foo {
    f := &amp;Foo{a: rand.Intn(50)}
    runtime.SetFinalizer(f, func(f *Foo) {
        fmt.Println(`foo ` + strconv.Itoa(i) + ` has been garbage collected`)
    })

    return f
}</code></pre>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒFinalizer æ— æ³•ä¿è¯è¢«è°ƒç”¨ï¼Œå³ï¼š</p>
<p><strong>åœ¨ç¨‹åºæ— æ³•è·å–åˆ°ä¸€ä¸ª obj æ‰€æŒ‡å‘çš„å¯¹è±¡åçš„ä»»æ„æ—¶åˆ»ï¼Œfinalizer è¢«è°ƒåº¦è¿è¡Œï¼Œä¸”æ— æ³•ä¿è¯ finalizer è¿è¡Œåœ¨ç¨‹åºé€€å‡ºä¹‹å‰ï¼›</strong></p>
<blockquote>
<p>  æ›´å¤šå†…å®¹ï¼Œè§ï¼š</p>
<ul>
<li><a href="https://studygolang.com/articles/23461" target="_blank" rel="noopener">https://studygolang.com/articles/23461</a></li>
</ul>
</blockquote>
<br>

<h3 id="Additional-Mechanisms"><a href="#Additional-Mechanisms" class="headerlink" title="Additional Mechanisms"></a><strong>Additional Mechanisms</strong></h3><blockquote>
<p>  The <code>sync</code> package provides additional synchronization abstractions, including <a href="https://go.dev/pkg/sync/#Cond" target="_blank" rel="noopener">condition variables</a>, <a href="https://go.dev/pkg/sync/#Map" target="_blank" rel="noopener">lock-free maps</a>, <a href="https://go.dev/pkg/sync/#Pool" target="_blank" rel="noopener">allocation pools</a>, and <a href="https://go.dev/pkg/sync/#WaitGroup" target="_blank" rel="noopener">wait groups</a>. The documentation for each of these specifies the guarantees it makes concerning synchronization.</p>
<p>  Other packages that provide synchronization abstractions should document the guarantees they make too.</p>
</blockquote>
<p><code>sync</code> åŒ…è¿˜æä¾›äº†æ›´å¤šå…³äºåŒæ­¥æ“ä½œçš„æŠ½è±¡ï¼ŒåŒ…æ‹¬ï¼š<a href="https://go.dev/pkg/sync/#Cond" target="_blank" rel="noopener">condition variables</a>, <a href="https://go.dev/pkg/sync/#Map" target="_blank" rel="noopener">lock-free maps</a>, <a href="https://go.dev/pkg/sync/#Pool" target="_blank" rel="noopener">allocation pools</a>, <a href="https://go.dev/pkg/sync/#WaitGroup" target="_blank" rel="noopener">wait groups</a> ç­‰ç­‰ï¼›å¯¹åº”çš„æ¯ä¸ªæ–‡æ¡£éƒ½è¯¦ç»†è¯´æ˜äº†å®ƒåœ¨åŒæ­¥æ–¹é¢çš„ä½œç”¨ï¼›</p>
<p>å…¶ä»–æä¾›åŒæ­¥æŠ½è±¡çš„åŒ…ä¹Ÿåº”è¯¥ä¸ºä»–ä»¬åœ¨çº¿ç¨‹åŒæ­¥ä¸­çš„ä½œç”¨æä¾›æ–‡æ¡£ï¼›</p>
<br>

<h2 id="ä¸æ­£ç¡®çš„åŒæ­¥ï¼ˆIncorrect-synchronizationï¼‰"><a href="#ä¸æ­£ç¡®çš„åŒæ­¥ï¼ˆIncorrect-synchronizationï¼‰" class="headerlink" title="ä¸æ­£ç¡®çš„åŒæ­¥ï¼ˆIncorrect synchronizationï¼‰"></a><strong>ä¸æ­£ç¡®çš„åŒæ­¥ï¼ˆIncorrect synchronizationï¼‰</strong></h2><blockquote>
<p>  Programs with races are incorrect and can exhibit non-sequentially consistent executions. In particular, note that a read <em>r</em> may observe the value written by any write <em>w</em> that executes concurrently with <em>r</em>. Even if this occurs, it does not imply that reads happening after <em>r</em> will observe writes that happened before <em>w</em>.</p>
<p>  In this program:</p>
<p>  it can happen that <code>g</code> prints <code>2</code> and then <code>0</code>.</p>
<p>  This fact invalidates a few common idioms.</p>
</blockquote>
<p>å«æœ‰ data race çš„ç¨‹åºä¼šå¯¼è‡´ä¸æ­£ç¡®æ€§ï¼Œå¹¶ä¸”ä»–ä»¬çš„æ‰§è¡Œé¡ºåºä¹Ÿè¡¨ç°çš„éé¡ºåºä¸€è‡´ï¼›å°¤å…¶æ˜¯ï¼Œåœ¨å¹¶å‘è¯»å†™æ“ä½œçš„æ—¶å€™ï¼Œä¸€ä¸ªè¯»æ“ä½œ <em>r</em> å¯èƒ½ä¹Ÿå¯èƒ½æ²¡æœ‰è¯»åˆ°å¦å¤–ä¸€ä¸ªå¹¶å‘çš„å†™æ“ä½œ <em>w</em> å†™å…¥çš„å€¼ï¼›</p>
<p>å³ä½¿è¯»æ“ä½œ <em>r</em> è¯»åˆ°äº†å†™å…¥çš„æ–°å€¼ï¼Œä¹Ÿä¸èƒ½è¯´æ˜å†™æ“ä½œ <em>w</em> ä¸€å®šå…ˆäºè¯»æ“ä½œ <em>r</em> å‘ç”Ÿï¼›</p>
<p>æ¥çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<p>incorrect-synchronization/demo1_test.go</p>
<pre><code class="go">var a, b int

func f() {
    a = 1
    b = 2
}

func g() {
    print(b)
    print(a)
}

func TestDemo1(t *testing.T) {
    go f()
    g()
}</code></pre>
<p>ä¸Šé¢çš„ä»£ç æœ‰æ—¶å¯èƒ½ä¼šè¾“å‡ºï¼š<code>2</code> ç„¶åè¾“å‡º <code>0</code>ï¼</p>
<p>è¿™ä¸ªäº‹å®å¯èƒ½ä¼šé¢ è¦†æˆ‘ä»¬çš„è®¤çŸ¥ï¼›</p>
<blockquote>
<p>  Double-checked locking is an attempt to avoid the overhead of synchronization. For example, the <code>twoprint</code> program might be incorrectly written as:</p>
<p>  but there is no guarantee that, in <code>doprint</code>, observing the write to <code>done</code> implies observing the write to <code>a</code>. This version can (incorrectly) print an empty string instead of <code>&quot;hello, world&quot;</code>.</p>
</blockquote>
<p>åŒé‡æ£€æŸ¥é”æ˜¯ä¸ºäº†é¿å…ä»£ç åŒæ­¥å¼€é”€ï¼›</p>
<p>ä¾‹å¦‚ï¼Œä¸€ä¸ªä¸æ­£ç¡®çš„  <code>twoprint</code> çš„å®ç°ï¼š</p>
<p>incorrect-synchronization/demo2_test.go</p>
<pre><code class="go">var a2 string
var done bool
var once sync.Once

func setup() {
    a2 = &quot;hello, world&quot;
    done = true
}

func doprint() {
    if !done {
        once.Do(setup)
    }
    print(a2)
}

func twoprint() {
    go doprint()
    go doprint()
}

func TestDemo2(t *testing.T) {
    twoprint()
}</code></pre>
<p>ä¸Šé¢çš„ <code>doprint</code> å‡½æ•°ä¸èƒ½ä¿è¯ï¼Œåœ¨è§‚å¯Ÿåˆ° <code>done</code> çš„åŒæ—¶ï¼Œè§‚å¯Ÿåˆ° <code>a</code> çš„å†™å…¥ï¼›</p>
<p>å› æ­¤ï¼Œä¸Šé¢çš„ä»£ç å¯èƒ½ä¼šå‡ºç°è¾“å‡ºäº†ç©ºå­—ç¬¦ä¸²è€Œé  <code>&quot;hello, world&quot;</code> çš„æƒ…å†µï¼</p>
<blockquote>
<p>  Another incorrect idiom is busy waiting for a value, as in:</p>
<p>  As before, there is no guarantee that, in <code>main</code>, observing the write to <code>done</code> implies observing the write to <code>a</code>, so this program could print an empty string too. Worse, there is no guarantee that the write to <code>done</code> will ever be observed by <code>main</code>, since there are no synchronization events between the two threads. The loop in <code>main</code> is not guaranteed to finish.</p>
</blockquote>
<p>å¦ä¸€ä¸ªä¸æ­£ç¡®çš„å¸¸è§è®¤çŸ¥æ˜¯ï¼Œå¿™äºç­‰å¾…ä¸€ä¸ªå€¼ï¼›</p>
<p>ä¾‹å¦‚ï¼š</p>
<p>incorrect-synchronization/demo3_test.go</p>
<pre><code class="go">var a3 string
var done3 bool

func setup3() {
    a3 = &quot;hello, world&quot;
    done3 = true
}

func TestDemo3(t *testing.T) {
    go setup3()
    for !done3 {
    }
    print(a3)
}</code></pre>
<p>å’Œå‰é¢çš„ä¾‹å­ç±»ä¼¼ï¼Œè¿™é‡Œçš„ main å‡½æ•°ä¹Ÿæ— æ³•ä¿è¯åœ¨è§‚å¯Ÿåˆ° <code>done</code> çš„åŒæ—¶ï¼Œè§‚å¯Ÿåˆ° <code>a</code> çš„å†™å…¥ï¼Œå› æ­¤è¿™æ®µä»£ç ä¹Ÿæœ‰å¯èƒ½æ‰“å°å‡ºç©ºå­—ç¬¦ä¸²ï¼›</p>
<p>æ›´åçš„æ˜¯ï¼Œä»–ç”šè‡³ä¸èƒ½ä¿è¯å¯¹å˜é‡ <code>done</code> çš„å†™å…¥èƒ½å¤Ÿåœ¨ main ä¸­è§‚æµ‹åˆ°ï¼Œæ¯•ç«Ÿä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´æ²¡æœ‰ä»»ä½•çš„åŒæ­¥æœºåˆ¶ï¼›</p>
<p>å› æ­¤æœ‰å¯èƒ½åœ¨ main ä¸­çš„ for å¾ªç¯æ°¸è¿œä¸ä¼šåœæ­¢ï¼</p>
<blockquote>
<p>  There are subtler variants on this theme, such as this program.</p>
<p>  Even if <code>main</code> observes <code>g != nil</code> and exits its loop, there is no guarantee that it will observe the initialized value for <code>g.msg</code>.</p>
<p>  In all these examples, the solution is the same: use explicit synchronization.</p>
</blockquote>
<p>è¿™ä¸ªé‡Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªæ¯”è¾ƒå¾®å¦™çš„å˜ä½“ï¼Œæ¥çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p>
<p>incorrect-synchronization/demo4_test.go</p>
<pre><code class="go">type T struct {
    msg string
}

var g4 *T

func setup4() {
    t := new(T)
    t.msg = &quot;hello, world&quot;
    g4 = t
}

func TestDemo4(t *testing.T) {
    go setup4()
    for g4 == nil {
    }
    print(g4.msg)
}</code></pre>
<p>å³ä½¿åœ¨ main å‡½æ•°ä¸­è§‚å¯Ÿåˆ°äº† <code>g != nil</code> å¹¶é€€å‡ºäº†å¾ªç¯ï¼Œè¿™ä¹Ÿä¸èƒ½ä¿è¯ main å‡½æ•°èƒ½å¤Ÿè§‚æµ‹åˆ°åœ¨ <code>g</code> ä¸­è¢«åˆå§‹åŒ–çš„å€¼  <code>g.msg</code>ï¼</p>
<blockquote>
<p>  <strong>è¿™é‡Œå¯ä»¥å‚è€ƒå‰é¢è¯´åˆ°çš„è¶…è¿‡ä¸€ä¸ªæœºå™¨å­—é•¿çš„åŒæ­¥ï¼›</strong></p>
</blockquote>
<p>åœ¨ä¸Šé¢æ‰€æœ‰çš„ä¾‹å­ä¸­ï¼Œè§£å†³æ–¹æ³•éƒ½æ˜¯ä¸€æ ·çš„ï¼šæ˜¾å¼çš„ä½¿ç”¨åŒæ­¥æœºåˆ¶ï¼›</p>
<br>

<h2 id="ç¼–è¯‘ç›¸å…³çš„é”™è¯¯ï¼ˆIncorrect-compilationï¼‰"><a href="#ç¼–è¯‘ç›¸å…³çš„é”™è¯¯ï¼ˆIncorrect-compilationï¼‰" class="headerlink" title="ç¼–è¯‘ç›¸å…³çš„é”™è¯¯ï¼ˆIncorrect compilationï¼‰"></a><strong>ç¼–è¯‘ç›¸å…³çš„é”™è¯¯ï¼ˆIncorrect compilationï¼‰</strong></h2><blockquote>
<p>  The Go memory model restricts compiler optimizations as much as it does Go programs. Some compiler optimizations that would be valid in single-threaded programs are not valid in all Go programs. In particular, a compiler must not introduce writes that do not exist in the original program, it must not allow a single read to observe multiple values, and it must not allow a single write to write multiple values.</p>
<p>  All the following examples assume that <code>*p</code> and <code>*q</code> refer to memory locations accessible to multiple goroutines.</p>
<p>  Not introducing data races into race-free programs means not moving writes out of conditional statements in which they appear. For example, a compiler must not invert the conditional in this program:</p>
<pre><code>  *p = 1
  if cond {
      *p = 2
  }</code></pre><p>  That is, the compiler must not rewrite the program into this one:</p>
<pre><code>  *p = 2
  if !cond {
      *p = 1
  }</code></pre><p>  If <code>cond</code> is false and another goroutine is reading <code>*p</code>, then in the original program, the other goroutine can only observe any prior value of <code>*p</code> and <code>1</code>. In the rewritten program, the other goroutine can observe <code>2</code>, which was previously impossible.</p>
</blockquote>
<p>Go çš„å†…å­˜æ¨¡å‹ä¸¥æ ¼é™åˆ¶äº†å®ƒèƒ½ä¸º Go ç¨‹åºæ‰€åšçš„ä¼˜åŒ–ï¼›æœ‰ä¸€äº›èƒ½å¤Ÿåœ¨å•çº¿ç¨‹ä¸‹è¿›è¡Œçš„ç¼–è¯‘ä¼˜åŒ–ï¼Œåœ¨ Go ç¨‹åºä¸­å¹¶éæ˜¯åˆæ³•çš„ï¼›å°¤å…¶æ˜¯ï¼Œç¼–è¯‘å™¨ä¸èƒ½åœ¨åŸç¨‹åºä¸­å¼•å…¥åŸæœ¬ä¸å­˜åœ¨çš„å†™æ“ä½œï¼Œä¹Ÿä¸èƒ½å…è®¸å•ä¸ªè¯»æ“ä½œè§‚å¯Ÿåˆ°å¤šä¸ªä¸åŒçš„å€¼ï¼Œå¹¶ä¸”ä»–å¿…é¡»ç¦æ­¢å•æ¬¡å†™å…¥å¯å†™å…¥å¤šä¸ªå€¼ï¼›</p>
<p>åœ¨ä¸‹é¢æ‰€æœ‰çš„ä¾‹å­ä¸­ï¼Œéƒ½å‡è®¾ ``<em>p<code>å’Œ</code></em>q` åœ¨å¤šä¸ª goroutine ä¸­æŒ‡å‘çš„å†…å­˜åœ°å€ï¼›</p>
<p>ä¸å¯¼è‡´ data race è¡¨ç¤ºï¼Œä¸è¦å°†å†™æ“ä½œä»ä»–ä»¬ä¹‹å‰çš„æ¡ä»¶è¯­å¥å—ä¸­ç§»å‡ºï¼›</p>
<p>ä¾‹å¦‚ï¼Œç¼–è¯‘å™¨ä¸èƒ½å¤Ÿè½¬æ¢ä¸‹é¢çš„ä»£ç ï¼š</p>
<pre><code class="go">*p = 1
if cond {
    *p = 2
}</code></pre>
<p>å³ï¼Œä¸èƒ½é‡å†™ä¸ºä¸‹é¢çš„ä»£ç ï¼š</p>
<pre><code class="go">*p = 2
if !cond {
    *p = 1
}</code></pre>
<p>å¦‚æœ <code>cond</code> æ˜¯ falseï¼Œå¹¶ä¸”å¦ä¸€ä¸ªgoroutineæ­£åœ¨è¯»å– <code>*p</code>ï¼›</p>
<p>é‚£ä¹ˆåœ¨ä¹‹å‰çš„ä»£ç ä¸­ï¼Œå¦ä¸€ä¸ª goroutine åªèƒ½è§‚å¯Ÿåˆ° <code>*p</code> ä¸º 1ï¼›è€Œåœ¨é‡å†™åçš„ä»£ç ä¸­ï¼Œå…¶ä»–goroutinå¯ä»¥è§‚å¯Ÿåˆ° 2ï¼Œè¿™åœ¨è½¬æ¢ä¹‹å‰ä¸å¯èƒ½çš„ï¼</p>
<blockquote>
<p>  Not introducing data races also means not assuming that loops terminate. For example, a compiler must in general not move the accesses to <code>*p</code> or <code>*q</code> ahead of the loop in this program:</p>
<pre><code>  n := 0
  for e := list; e != nil; e = e.next {
      n++
  }
  i := *p
  *q = 1</code></pre><p>  If <code>list</code> pointed to a cyclic list, then the original program would never access <code>*p</code> or <code>*q</code>, but the rewritten program would. (Moving <code>*p</code> ahead would be safe if the compiler can prove <code>*p</code> will not panic; moving <code>*q</code> ahead would also require the compiler proving that no other goroutine can access <code>*q</code>.)</p>
</blockquote>
<p>ä¸å¯¼è‡´ data race è¿˜è¯´æ˜äº†ï¼Œä¸å‡è®¾å¾ªç¯ä¼šç»ˆæ­¢ï¼›</p>
<p>ä¾‹å¦‚ï¼Œç¼–è¯‘å™¨ä¸èƒ½å°†  <code>*p</code> or <code>*q</code> æå‡ºåˆ°å¾ªç¯ä¹‹å‰ï¼š</p>
<pre><code class="go">n := 0
for e := list; e != nil; e = e.next {
    n++
}
i := *p
*q = 1</code></pre>
<p>å¦‚æœ <code>list</code> æ˜¯ä¸€ä¸ªå¾ªç¯åˆ—è¡¨ï¼Œé‚£ä¹ˆåœ¨è½¬æ¢ä¹‹å‰çš„ç¨‹åºæ˜¯æ— æ³•è®¿é—®åˆ°  <code>*p</code> å’Œ <code>*q</code> çš„ï¼Œä½†æ˜¯è½¬æ¢ä¹‹åçš„ä»£ç å°±ä¼šäº†ï¼</p>
<p>ï¼ˆèƒ½å¤Ÿå°† <code>*p</code> å®‰å…¨æå‰çš„å‰ææ¡ä»¶æ˜¯ç¼–è¯‘å™¨èƒ½å¤Ÿä¿è¯ <code>*p</code> ä¸ä¼šå¼•å‘ panicï¼›èƒ½å¤Ÿå°†  <code>*q</code>  æå‰çš„å‰ææ¡ä»¶æ˜¯ç¼–è¯‘å™¨èƒ½å¤Ÿä¿è¯æ²¡æœ‰å…¶ä»–çš„ goroutine ä¼šè®¿é—®  <code>*q</code> çš„å†…å­˜åœ°å€ï¼‰ï¼›</p>
<blockquote>
<p>  Not introducing data races also means not assuming that called functions always return or are free of synchronization operations. For example, a compiler must not move the accesses to <code>*p</code> or <code>*q</code> ahead of the function call in this program (at least not without direct knowledge of the precise behavior of <code>f</code>):</p>
<pre><code>  f()
  i := *p
  *q = 1</code></pre><p>  If the call never returned, then once again the original program would never access <code>*p</code> or <code>*q</code>, but the rewritten program would. And if the call contained synchronizing operations, then the original program could establish happens before edges preceding the accesses to <code>*p</code> and <code>*q</code>, but the rewritten program would not.</p>
</blockquote>
<p>ä¸å¯¼è‡´ data race è¿˜è¯´æ˜äº†ï¼Œä¸èƒ½å‡è®¾æ‰€æœ‰çš„å‡½æ•°è°ƒç”¨éƒ½èƒ½æ­£å¸¸è¿”å›ï¼Œæˆ–è€…å‡è®¾ï¼ˆå‡½æ•°å†…ï¼‰æ— åŒæ­¥æ“ä½œï¼›</p>
<p>ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p>
<pre><code class="go">f()
i := *p
*q = 1</code></pre>
<p>ç¼–è¯‘å™¨ä¸èƒ½å°†  <code>*p</code> or <code>*q</code> ç§»åŠ¨åˆ°å‡½æ•°è°ƒç”¨ä¹‹å‰ï¼ˆè‡³å°‘åœ¨ä¸äº†è§£å‡½æ•° <code>f</code> çš„è¡Œä¸ºçš„æ—¶å€™ï¼‰ï¼›</p>
<p>å¦‚æœå‡½æ•°è°ƒç”¨æ°¸è¿œä¹Ÿä¸è¿”å›ï¼Œé‚£ä¹ˆä¹‹å‰çš„ä»£ç æ˜¯æ— æ³•è®¿é—®  <code>*p</code> æˆ–è€… <code>*q</code> çš„ï¼Œä½†æ˜¯é‡å†™ä¹‹åçš„ä»£ç å°±ä¼šè®¿é—®ï¼›</p>
<p>å¹¶ä¸”ï¼Œå¦‚æœå‡½æ•°ä¸­å­˜åœ¨åŒæ­¥æ“ä½œï¼Œé‚£ä¹ˆä¹‹å‰çš„ä»£ç ä¼šåœ¨è®¿é—® <code>*p</code> æˆ–è€… <code>*q</code> ä¹‹å‰å»ºç«‹ happen-before éš”ç¦»ï¼Œè€Œé‡å†™ä¹‹åçš„ä»£ç å°±ä¸ä¼šï¼›</p>
<blockquote>
<p>  Not allowing a single read to observe multiple values means not reloading local variables from shared memory. For example, a compiler must not discard <code>i</code> and reload it a second time from <code>*p</code> in this program:</p>
<pre><code>  i := *p
  if i &lt; 0 || i &gt;= len(funcs) {
      panic(&quot;invalid function index&quot;)
  }
  ... complex code ...
  // compiler must NOT reload i = *p here
  funcs[i]()</code></pre><p>  If the complex code needs many registers, a compiler for single-threaded programs could discard <code>i</code> without saving a copy and then reload <code>i = *p</code> just before <code>funcs[i]()</code>. A Go compiler must not, because the value of <code>*p</code> may have changed. (Instead, the compiler could spill <code>i</code> to the stack.)</p>
</blockquote>
<p>ä¸å…è®¸å•ä¸ªè¯»æ“ä½œè¯»å–åˆ°å¤šä¸ªå€¼è¡¨ç¤ºï¼šä¸ä»å…±äº«å†…å­˜ä¸­é‡æ–°åŠ è½½å±€éƒ¨å˜é‡ï¼›</p>
<p>ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p>
<pre><code class="go">i := *p
if i &lt; 0 || i &gt;= len(funcs) {
    panic(&quot;invalid function index&quot;)
}
... complex code ...
// compiler must NOT reload i = *p here
funcs[i]()</code></pre>
<p>ç¼–è¯‘å™¨ä¸èƒ½å°†åŸ <code>i</code> å€¼ä¸¢å¼ƒï¼Œå¹¶ä¸”é‡æ–°ä» <code>*p</code> ä¸­è¯»å–æ–°çš„å€¼ï¼</p>
<p>å¦‚æœä¸€äº›å¤æ‚çš„ä»£ç éœ€è¦è®¸å¤šå¯„å­˜å™¨ï¼Œåˆ™æœ‰ä¸€äº›ç¼–è¯‘å™¨åœ¨ä¼˜åŒ–å•çº¿ç¨‹çš„ç¨‹åºæ—¶ï¼Œä¼šåœ¨è°ƒç”¨  <code>funcs[i]()</code> ä¹‹å‰ï¼Œå…ˆä¸¢å¼ƒ <code>i</code> å¹¶ä¸”ä¸ä¿å­˜ä»–çš„å€¼ï¼Œè€Œä¸”å†æ¬¡ä½¿ç”¨  <code>i = *p</code> é‡æ–°å†™å…¥æ–°å€¼ï¼›</p>
<p>è€Œ Go ç¼–è¯‘å™¨ä¸å…è®¸è¿™ä¹ˆåšï¼Œå› ä¸º <code>*p</code> çš„å€¼å¯èƒ½ä¼šå˜ï¼ˆå–è€Œä»£ä¹‹ï¼Œç¼–è¯‘å™¨ä¼šå°† <code>i</code> å†™å…¥åˆ°å‡½æ•°æ ˆä¸Šï¼‰ï¼›</p>
<blockquote>
<p>  Not allowing a single write to write multiple values also means not using the memory where a local variable will be written as temporary storage before the write. For example, a compiler must not use <code>*p</code> as temporary storage in this program:</p>
<pre><code>  *p = i + *p/2</code></pre><p>  That is, it must not rewrite the program into this one:</p>
<pre><code>  *p /= 2
  *p += i</code></pre><p>  If <code>i</code> and <code>*p</code> start equal to 2, the original code does <code>*p = 3</code>, so a racing thread can read only 2 or 3 from <code>*p</code>. The rewritten code does <code>*p = 1</code> and then <code>*p = 3</code>, allowing a racing thread to read 1 as well.</p>
</blockquote>
<p>ä¸å…è®¸å•ä¸ªå†™æ“ä½œå¤šæ¬¡å†™å…¥ä¹Ÿè¡¨ç¤ºï¼šä¸æ˜¯ä½¿ç”¨ local å˜é‡å°†è¢«å†™å…¥çš„å†…å­˜ä½œä¸ºå†™å…¥å‰çš„ä¸´æ—¶å­˜å‚¨ï¼›</p>
<p>ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<pre><code class="go">*p = i + *p/2</code></pre>
<p>ç¼–è¯‘å™¨ä¸èƒ½å°†  <code>*p</code>  ä½œä¸ºä¸´æ—¶è®¡ç®—ç»“æœå€¼çš„å­˜å‚¨åŒºåŸŸï¼›</p>
<p>ä¹Ÿå³ï¼Œç¼–è¯‘å™¨ä¸èƒ½å°†ä»£ç é‡å†™ä¸ºè¿™æ ·ï¼š</p>
<pre><code class="go">*p /= 2
*p += i</code></pre>
<p>å¦‚æœ <code>i</code> å’Œ <code>*p</code> æœ€åˆéƒ½ä¸º 2ï¼Œåˆ™æœ€åˆçš„ä»£ç ä¼šå°† <code>*p</code> èµ‹å€¼ä¸º 3ï¼Œå› æ­¤å…·æœ‰ data race çš„ä»£ç å¯èƒ½ä¼šä» <code>*p</code> è¯»å–åˆ° 2 æˆ–è€… 3ï¼›</p>
<p>è€Œé‡å†™åçš„ä»£ç å¯èƒ½ä¼šä» <code>*p</code> ä¸­è¯»å–åˆ° 1 æˆ–è€… 3ï¼</p>
<blockquote>
<p>  Note that all these optimizations are permitted in C/C++ compilers: a Go compiler sharing a back end with a C/C++ compiler must take care to disable optimizations that are invalid for Go.</p>
<p>  Note that the prohibition on introducing data races does not apply if the compiler can prove that the races do not affect correct execution on the target platform. For example, on essentially all CPUs, it is valid to rewrite</p>
<pre><code>  n := 0
  for i := 0; i &lt; m; i++ {
      n += *shared
  }</code></pre><p>  into:</p>
<pre><code>  n := 0
  local := *shared
  for i := 0; i &lt; m; i++ {
      n += local
  }</code></pre><p>  provided it can be proved that <code>*shared</code> will not fault on access, because the potential added read will not affect any existing concurrent reads or writes. On the other hand, the rewrite would not be valid in a source-to-source translator.</p>
</blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šé¢æåˆ°çš„æ‰€æœ‰ä¼˜åŒ–åœ¨ C/C++ çš„ç¼–è¯‘å™¨ä¸­éƒ½æ˜¯è¢«å…è®¸çš„ï¼›å› æ­¤ï¼Œä¸€ä¸ªä¸ C/C++ ç¼–è¯‘å™¨å…±äº«åç«¯çš„ Goç¼–è¯‘å™¨çš„å®ç°å¿…é¡»è¦æ³¨æ„ç¦ç”¨æ‰åœ¨ Go ä¸­è¢«ç¦æ­¢çš„ä¼˜åŒ–ï¼</p>
<p>åŒæ—¶è¦æ³¨æ„ï¼Œå¦‚æœç¼–è¯‘å™¨èƒ½å¤Ÿä¿è¯ data race ä¸ä¼šå½±å“åˆ°ç›®æ ‡å¹³å°æ‰§è¡Œçš„æ­£ç¡®æ€§ï¼Œåˆ™ä¸Šè¿°ç¦æ­¢å¼•å…¥ data race çš„è§„å®šå°±å¯ä»¥ä¸é€‚ç”¨ï¼›</p>
<p>ä¾‹å¦‚ï¼šåœ¨åŸºæœ¬ä¸Šæ‰€æœ‰çš„CPUä¸Šï¼Œä¸‹é¢çš„é‡å†™æ˜¯å¯ä»¥çš„ï¼š</p>
<pre><code class="go">n := 0
for i := 0; i &lt; m; i++ {
    n += *shared
}</code></pre>
<p>é‡å†™åï¼š</p>
<pre><code class="go">n := 0
local := *shared
for i := 0; i &lt; m; i++ {
    n += local
}</code></pre>
<p>å‰ææ˜¯å¯ä»¥è¯æ˜ <code>*shared</code> ä¸ä¼šåœ¨è®¿é—®æ—¶å‡ºé”™ï¼Œå› ä¸ºæ·»åŠ è¯»æ“ä½œä¸ä¼šå½±å“åˆ°ä»»ä½•åŸæœ‰çš„å¹¶å‘è¯»æˆ–å†™ï¼›</p>
<p>å¦ä¸€æ–¹é¢ï¼Œé‡å†™åœ¨æºåˆ°æºè½¬æ¢å™¨ï¼ˆsource-to-source translatorï¼‰ä¸­æ— æ•ˆï¼›</p>
<br>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h2><blockquote>
<p>  Go programmers writing data-race-free programs can rely on sequentially consistent execution of those programs, just as in essentially all other modern programming languages.</p>
<p>  When it comes to programs with races, both programmers and compilers should remember the advice: donâ€™t be clever.</p>
</blockquote>
<p>Go çš„å¼€å‘è€…å¯ä»¥ä¾é å‰æ–‡ä¸­æ‰€è¯´çš„é¡ºåºä¸€è‡´æ‰§è¡Œæ¥ç¼–å†™ data-race-free çš„ä»£ç ï¼Œè¿™ä¸ªå…¶ä»–ç°ä»£ç¼–ç¨‹è¯­è¨€æ˜¯ä¸€æ ·çš„ï¼›</p>
<p>å½“é‡åˆ°äº† data raceï¼Œå¼€å‘è€…å’Œç¼–è¯‘å™¨éƒ½åº”å½“å¬å–è¿™ä¸ªå»ºè®®ï¼šä¸è¦è‡ªä½œèªæ˜ï¼ˆ<code>don&#39;t be clever.</code>ï¼‰</p>
<br>

<h1 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a><strong>é™„å½•</strong></h1><p>åŸæ–‡åœ°å€ï¼š</p>
<ul>
<li><a href="https://go.dev/ref/mem" target="_blank" rel="noopener">https://go.dev/ref/mem</a></li>
</ul>
<p>æºä»£ç ï¼š</p>
<ul>
<li><a href="https://github.com/JasonkayZK/go-learn/tree/go-memory-model" target="_blank" rel="noopener">https://github.com/JasonkayZK/go-learn/tree/go-memory-model</a></li>
</ul>
<br>

  </article>

  <div id="like-container" style="text-align: center">
    <div class="like-feed">
      <p>è§‰å¾—æœ¬æ–‡ä¸é”™å°±ç‚¹ä¸ª<span>â™¥</span>å†èµ°å§~</p>
      <div class="like-img">
        <div class="like-heart" id="like" rel="like"></div>
        <div class="like-count" id="like-count"></div>
      </div>
    </div>
  </div>

  <!-- æ–‡ç« åˆ†äº« -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
  <div class="social-share" data-mode="prepend" data-disabled="tencent,diandian"></div>
  <br>

  
  
<div class="nexmoe-post-copyright">
<i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
<strong>æœ¬æ–‡ä½œè€…ï¼š</strong>Jasonkay<br>
<strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href="https://jasonkayzk.github.io/2022/10/26/ã€ç¿»è¯‘ã€‘Goå†…å­˜æ¨¡å‹/" title="https://jasonkayzk.github.io/2022/10/26/ã€ç¿»è¯‘ã€‘Goå†…å­˜æ¨¡å‹/" target="_blank" rel="noopener">https://jasonkayzk.github.io/2022/10/26/ã€ç¿»è¯‘ã€‘Goå†…å­˜æ¨¡å‹/</a><br>

  <strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬æ–‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> åè®®è¿›è¡Œè®¸å¯

</div>


  

  <!-- å¢åŠ é¢è¯•ç‚¹å‡»æ ‡é¢˜æ‰æ˜¾ç¤ºç­”æ¡ˆç­‰æ•ˆæœ! -->
  <!-- <script type="text/javascript">
    $(".question").click(function () {
      var a = $(".answer").eq($(".question").index(this));
      a.is(".answer_shown") ? a.animate({ 'opacity': '1' }, 800).removeClass("answer_shown") : a.animate({ 'opacity': '0' }, 800).addClass("answer_shown");
    });
  </script> -->
  <!-- <style>
    .answer_shown {
      opacity: 0;
    }
  </style> -->

  <!-- åŠ è½½åšå®¢ç‚¹èµåŠŸèƒ½ -->
  <script>
    function ajax(options) {
      return new Promise(function (resolve, reject) {
        $.ajax(options).done(resolve).fail(reject);
      });
    }

    var docName = $('meta[property="og:title"]').attr('content');
    
    // è·³è¿‡localhost
    if (location.hostname !== 'localhost') {
      // åˆå§‹åŒ–
      ajax({
        url: "https://service-rvqf6dam-1257829547.gz.apigw.tencentcs.com/blog_like/",
        type: 'post',
        contentType: 'application/json; charset=utf-8',
        data: JSON.stringify({
          "actionId": "get",
          "docName": docName
        })
      }).then(
        function fulfillHandler(data) {
          $('#like-count').text(data.likeNum);
        },
        function rejectHandler(jqXHR, textStatus, errorThrown) {
          $('#like-count').text(0);
          console.log(jqXHR, textStatus, errorThrown);
        }
      ).catch(function errorHandler(error) {
        $('#like-count').text(0);
        console.log(error);
      });

      $(document).ready(function () {
        $(".like-heart").on("click", function () {
          var heart = $(this);
          var likeCount = $("#like-count" + heart.attr("id").split("like")[1]);
          var intCount = parseInt(likeCount.html());
          var rel = heart.attr("rel");

          if (rel === "like") {
            likeCount.html(intCount + 1);
            heart.addClass("like-heartAnimation").attr("rel", "unlike");
            ajax({
              url: "https://service-rvqf6dam-1257829547.gz.apigw.tencentcs.com/blog_like/",
              type: 'post',
              contentType: 'application/json; charset=utf-8',
              data: JSON.stringify({
                "actionId": "add",
                "docName": docName
              })
            }).catch(function errorHandler(error) {
              console.log(error);
            });
          } else {
            likeCount.html(intCount - 1);
            heart.removeClass("like-heartAnimation").attr("rel", "like");
            heart.css("background-position", "left");
            ajax({
              url: "https://service-rvqf6dam-1257829547.gz.apigw.tencentcs.com/blog_like/",
              type: 'post',
              contentType: 'application/json; charset=utf-8',
              data: JSON.stringify({
                "actionId": "subtract",
                "docName": docName
              })
            }).catch(function errorHandler(error) {
              console.log(error);
            });
          }
        }).on("mouseleave", function () {
          $(this).css("background-position", "");
        });
      });
    }
  </script>
  <style>
    #like-container {
      margin: 0 auto;
      width: 100%;
    }

    .like-img {
      width: 200px;
      height: 100px;
      display: inline-block;
    }

    .like-heart {
      float: left;
      background: url(/images/web_heart_animation.png);
      background-position: left;
      background-repeat: no-repeat;
      height: 50px;
      width: 120px;
      left: -14px;
      background-size: 2900%;
    }

    .like-count {
      float: left;
      font-family: 'Georgia', Times, Times New Roman, serif;
      font-size: 35px;
      color: #999999;
      text-align: left;
      height: 50px;
      width: 50px;
      line-height: 44px;
    }

    .like-heart:hover,
    .like-heart:focus {
      background-position: right;
    }

    @-webkit-keyframes heartBlast {
      0% {
        background-position: left;
      }

      100% {
        background-position: right;
      }
    }

    @keyframes heartBlast {
      0% {
        background-position: left;
      }

      100% {
        background-position: right;
      }
    }

    .like-heartAnimation {
      display: inline-block;
      -webkit-animation-name: heartBlast;
      animation-name: heartBlast;
      -webkit-animation-duration: .8s;
      animation-duration: .8s;
      -webkit-animation-iteration-count: 1;
      animation-iteration-count: 1;
      -webkit-animation-timing-function: steps(28);
      animation-timing-function: steps(28);
      background-position: right;
    }

    .like-feed {
      height: 90px;
      margin-bottom: 20px;
      text-align: center
    }

    .like-feed p {
      font-family: 'microsoft yahei', 'Georgia';
      font-size: 25px;
    }

    .like-feed span {
      font-size: 30px;
      color: #D33115;
    }
  </style>

  <section class="nexmoe-comment">
    <div class="utterances"></div>
<style>
    .v .vwrap {
      border: 1px dashed #c4bfbf
    }
  
    .v .vwrap .vheader .vinput {
      border-bottom: 1px dashed #c4bfbf
    }
</style>
<script src="https://utteranc.es/client.js" repo="JasonkayZK/JasonkayZK.github.io" issue-term="title" label="commentâœ¨ğŸ’¬âœ¨" theme="github-light" crossorigin="anonymous" async>
</script>

</section>
</div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/mdui@0.4.3/dist/js/mdui.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
 
    <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>


 
    <script src="https://cdn.jsdelivr.net/npm/smoothscroll-for-websites@1.4.9/SmoothScroll.min.js"></script>


<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.16.2/build/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script src="/js/app.js?v=1770725316053"></script>
<script src="https://cdn.jsdelivr.net/npm/lazysizes@5.1.0/lazysizes.min.js"></script>




  
    <!-- Google Analytics -->
<script>
    window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
    ga('create', 'G-1NWK4EEKDF', 'auto');
    ga('send', 'pageview');
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>






    <!-- baidu Analytics -->
<script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?5f5ec71a32c11ff54dff64d0341017b0";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
</script>

</body>

<!-- é¡µé¢ç‚¹å‡»å°çº¢å¿ƒ -->
<!-- 
<script type="text/javascript">
  !function (e, t, a) { function n() { c(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), o(), r() } function r() { for (var e = 0; e < d.length; e++)d[e].alpha <= 0 ? (t.body.removeChild(d[e].el), d.splice(e, 1)) : (d[e].y--, d[e].scale += .004, d[e].alpha -= .013, d[e].el.style.cssText = "left:" + d[e].x + "px;top:" + d[e].y + "px;opacity:" + d[e].alpha + ";transform:scale(" + d[e].scale + "," + d[e].scale + ") rotate(45deg);background:" + d[e].color + ";z-index:99999"); requestAnimationFrame(r) } function o() { var t = "function" == typeof e.onclick && e.onclick; e.onclick = function (e) { t && t(), i(e) } } function i(e) { var a = t.createElement("div"); a.className = "heart", d.push({ el: a, x: e.clientX - 5, y: e.clientY - 5, scale: 1, alpha: 1, color: s() }), t.body.appendChild(a) } function c(e) { var a = t.createElement("style"); a.type = "text/css"; try { a.appendChild(t.createTextNode(e)) } catch (t) { a.styleSheet.cssText = e } t.getElementsByTagName("head")[0].appendChild(a) } function s() { return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")" } var d = []; e.requestAnimationFrame = function () { return e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) { setTimeout(e, 1e3 / 60) } }(), n() }(window, document);
</script>
 -->
 
<script>
  // è¿›åº¦æ¡åŠ è½½: nprogress
  NProgress.start()
  NProgress.done()
</script>

<script type="text/javascript" defer>
  $(document).ready(function () {
    $.goup({
      trigger: 100,
      bottomOffset: 50,
      locationOffset: 50,
      title: '0%',
      titleAsText: true
    });
    $(".goup-container").css("background", "#64dcf0 none repeat scroll 0% 0%").css("opacity", 0.9);
    $(".goup-text").css("font-weight", 600).css("opacity", 0.9);
  });

  $(document).scroll(function () {
    var d_h = $(document).height();
    var c_h = $(window).height();
    var c_t_h = $(window).scrollTop();
    var schedule = c_t_h / (d_h - c_h - 0.5);
    var str = Number(schedule * 100).toFixed();
    str += "%";
    $(".goup-text").text(str);
  });
</script>

<!-- ç«™å†…é€šçŸ¥ -->
<script src="/js/notification.js"></script>
<script>
  'use strict';

  (function () {
    $(function () {
      $('.position').click(function (event) {
        var el = $(event.target);
        $('.position').removeClass('selected');
        el.addClass('selected');
        position = el.attr('data-position');
      });
    });
  });

  var position = 2;
  // å…³é—­ç™¾æ¯«ç§’æ•°
  var closeTime = 50;
  var notifyFunc = function () {
    // Notification.create(
    //   //Â Title
    //   "Tencentå†…æ¨ä¸­ğŸ“§",
    //   //Â Text
    //   "ç®€å†æŠ•é€’å¤„ï¼š<BR/><a href='/hiring/'>ç®€å†æŠ•é€’</a>",
    //   //Â Illustration
    //   "/images/avatar4.jpg",
    //   //Â Effect
    //   'fadeInRight',
    //   //Â PositionÂ 1, 2,Â 3,Â 4
    //   position,
    //   closeTime
    // );
    // setTimeout(() => {
    //   Notification.create(
    //     "èµ„æºä¸‹è½½âš¡",
    //     "ä¼ é€é—¨ï¼š<BR/><a href='/sharing/'>æ–‡ä»¶åˆ†äº«</a>",
    //     "/images/avatar4.jpg",
    //     'fadeInRight',
    //     position,
    //     closeTime
    //   )
    // }, 350);
    setTimeout(() => {
      Notification.create(
        "RSSè®¢é˜…ğŸ“¢",
        "ä¼ é€é—¨ï¼š<BR/><a href='/atom.xml'>RSSè®¢é˜…</a>",
        "/images/avatar4.jpg",
        'fadeInRight',
        position,
        closeTime
      )
    }, 0);
    setTimeout(() => {
        Notification.create(
        "åœ¨çº¿ç¾¤èŠğŸ’­",
        "ä¼ é€é—¨ï¼š<BR/><a href='/chat/'>ç•…æ‰€æ¬²è¨€</a>",
        "/images/avatar4.jpg",
        'fadeInRight',
        position,
        closeTime
      )
    }, 350);
    setTimeout(() => {
        Notification.create(
        // "è·‘æ­¥å¥èº«ğŸƒ",
        // "ä¼ é€é—¨ï¼š<BR/><a href='/running/'>è·‘æ­¥å¥èº«</a>",
        "æ‘„å½±åˆ†äº«ğŸ“·",
        "ä¼ é€é—¨ï¼š<BR/><a href='http://159.75.131.252:32352/'>æ‘„å½±åˆ†äº«</a>",
        "/images/avatar4.jpg",
        'fadeInRight',
        position,
        closeTime
      )
    }, 700);
  };

  (function once() {
    if (sessionStorage.getItem('load') == null) {
      notifyFunc();
      sessionStorage.setItem('load', false);
    } else {
      return;
    }
  })();
</script>
<script>
  $(document).on("click", ".dismiss", function (e) {
    Notification.hide(e.currentTarget.classList[1].split('-')[1]);
  })
</script>

</html>